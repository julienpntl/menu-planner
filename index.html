<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#14b8a6">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Menu Planner">
  <title>Menu Planner</title>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.png">
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * { -webkit-tap-highlight-color: transparent; }
    body { 
      margin: 0; 
      overscroll-behavior: none;
      -webkit-font-smoothing: antialiased;
    }
    input, select, textarea { font-size: 16px !important; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useCallback, memo } = React;

    // Icons as simple SVG components
    const Icon = ({ d, className = "w-5 h-5" }) => (
      <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
        <path strokeLinecap="round" strokeLinejoin="round" d={d} />
      </svg>
    );

    const Icons = {
      shuffle: "M16 3h5v5M4 20L21 3M21 16v5h-5M15 15l6 6M4 4l5 5",
      calendar: "M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z",
      cart: "M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z",
      edit: "M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z",
      arrowLeft: "M10 19l-7-7m0 0l7-7m-7 7h18",
      refresh: "M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15",
      plus: "M12 4v16m8-8H4",
      minus: "M20 12H4",
      trash: "M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16",
      check: "M5 13l4 4L19 7",
      x: "M6 18L18 6M6 6l12 12",
      chevronDown: "M19 9l-7 7-7-7",
      chevronUp: "M5 15l7-7 7 7",
      grip: "M8 6h.01M8 12h.01M8 18h.01M16 6h.01M16 12h.01M16 18h.01",
      users: "M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z",
      clock: "M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z",
      list: "M4 6h16M4 12h16M4 18h16",
      save: "M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"
    };

    // Base de donnÃ©es initiale
    const defaultMealsDatabase = [
  // === VIANDES ===
  { id: 1, name: "Aligot saucisse", category: "viande", servings: 2, description: "PurÃ©e Ã  l'aligot avec saucisse grillÃ©e", ingredients: [{ name: "Saucisse", quantity: 1, unit: "piÃ¨ce" }, { name: "Pommes de terre", quantity: 200, unit: "g" }, { name: "Tome fraÃ®che", quantity: 50, unit: "g" }, { name: "CrÃ¨me fraÃ®che", quantity: 3, unit: "cl" }] },
  { id: 2, name: "Riz cantonais", category: "viande", servings: 2, description: "Riz sautÃ© avec petits pois, jambon, omelette", ingredients: [{ name: "Riz", quantity: 80, unit: "g" }, { name: "Jambon", quantity: 50, unit: "g" }, { name: "Petits pois", quantity: 50, unit: "g" }, { name: "Å’ufs", quantity: 1, unit: "piÃ¨ce" }] },
  { id: 3, name: "Riz ratatouille poulet", category: "viande", servings: 2, description: "Riz ou semoule avec ratatouille et poulet", ingredients: [{ name: "Riz", quantity: 80, unit: "g" }, { name: "Filet de poulet", quantity: 120, unit: "g" }, { name: "Ratatouille", quantity: 150, unit: "g" }] },
  { id: 4, name: "Riz Ã©pinards steak", category: "viande", servings: 1, description: "Riz ou pÃ¢tes avec Ã©pinards et steak", ingredients: [{ name: "Riz", quantity: 80, unit: "g" }, { name: "Steak hachÃ©", quantity: 1, unit: "piÃ¨ce" }, { name: "Ã‰pinards", quantity: 100, unit: "g" }] },
  { id: 5, name: "Riz chili", category: "viande", servings: 2, description: "Riz avec chili con carne", ingredients: [{ name: "Riz", quantity: 80, unit: "g" }, { name: "Viande hachÃ©e", quantity: 100, unit: "g" }, { name: "Haricots rouges", quantity: 80, unit: "g" }, { name: "Tomates concassÃ©es", quantity: 100, unit: "g" }] },
  { id: 6, name: "Riz poulet au curry", category: "viande", servings: 2, description: "Poulet sauce curry avec riz", ingredients: [{ name: "Riz", quantity: 80, unit: "g" }, { name: "Filet de poulet", quantity: 120, unit: "g" }, { name: "Lait de coco", quantity: 10, unit: "cl" }, { name: "PÃ¢te de curry", quantity: 1, unit: "c. Ã  soupe" }] },
  { id: 7, name: "PÃ¢tes carbo", category: "viande", servings: 2, description: "Carbonara : lardons, Å“ufs, parmesan", ingredients: [{ name: "PÃ¢tes", quantity: 100, unit: "g" }, { name: "Lardons", quantity: 50, unit: "g" }, { name: "Å’ufs", quantity: 1, unit: "piÃ¨ce" }, { name: "Parmesan", quantity: 20, unit: "g" }, { name: "CrÃ¨me fraÃ®che", quantity: 2, unit: "cl" }] },
  { id: 8, name: "PÃ¢tes bolo", category: "viande", servings: 2, description: "PÃ¢tes Ã  la bolognaise", ingredients: [{ name: "PÃ¢tes", quantity: 100, unit: "g" }, { name: "Viande hachÃ©e", quantity: 100, unit: "g" }, { name: "Tomates concassÃ©es", quantity: 100, unit: "g" }, { name: "Oignons", quantity: 0.5, unit: "piÃ¨ce" }] },
  { id: 9, name: "PÃ¢tes courgettes poulet", category: "viande", servings: 2, description: "PÃ¢tes aux courgettes et poulet", ingredients: [{ name: "PÃ¢tes", quantity: 100, unit: "g" }, { name: "Filet de poulet", quantity: 100, unit: "g" }, { name: "Courgettes", quantity: 1, unit: "piÃ¨ce" }, { name: "CrÃ¨me fraÃ®che", quantity: 3, unit: "cl" }] },
  { id: 10, name: "PÃ¢tes courgettes steak", category: "viande", servings: 1, description: "PÃ¢tes aux courgettes et steak hachÃ©", ingredients: [{ name: "PÃ¢tes", quantity: 100, unit: "g" }, { name: "Steak hachÃ©", quantity: 1, unit: "piÃ¨ce" }, { name: "Courgettes", quantity: 1, unit: "piÃ¨ce" }] },
  { id: 11, name: "PÃ¢tes filet mignon", category: "viande", servings: 2, description: "PÃ¢tes au filet mignon", ingredients: [{ name: "PÃ¢tes", quantity: 100, unit: "g" }, { name: "Filet mignon", quantity: 100, unit: "g" }, { name: "Champignons", quantity: 80, unit: "g" }, { name: "CrÃ¨me fraÃ®che", quantity: 3, unit: "cl" }] },
  { id: 12, name: "Gnocchi steak", category: "viande", servings: 1, description: "Gnocchi avec steak hachÃ©", ingredients: [{ name: "Gnocchi", quantity: 150, unit: "g" }, { name: "Steak hachÃ©", quantity: 1, unit: "piÃ¨ce" }, { name: "Sauce tomate", quantity: 5, unit: "cl" }] },
  { id: 13, name: "Gnocchi poulet", category: "viande", servings: 2, description: "Gnocchi avec poulet", ingredients: [{ name: "Gnocchi", quantity: 150, unit: "g" }, { name: "Filet de poulet", quantity: 100, unit: "g" }, { name: "CrÃ¨me fraÃ®che", quantity: 3, unit: "cl" }] },
  { id: 14, name: "Patates poivrons omelette", category: "viande", servings: 2, description: "Pommes de terre sautÃ©es, poivrons, omelette", ingredients: [{ name: "Pommes de terre", quantity: 200, unit: "g" }, { name: "Poivrons", quantity: 1, unit: "piÃ¨ce" }, { name: "Å’ufs", quantity: 2, unit: "piÃ¨ces" }] },
  { id: 15, name: "Patates grillÃ©es lardons champignons", category: "viande", servings: 2, description: "Patates grillÃ©es, lardons, champignons, oignons", ingredients: [{ name: "Pommes de terre", quantity: 200, unit: "g" }, { name: "Lardons", quantity: 50, unit: "g" }, { name: "Champignons", quantity: 80, unit: "g" }, { name: "Oignons", quantity: 0.5, unit: "piÃ¨ce" }] },
  { id: 16, name: "Lentilles saucisses", category: "viande", servings: 2, description: "Lentilles aux saucisses", ingredients: [{ name: "Lentilles", quantity: 100, unit: "g" }, { name: "Saucisses", quantity: 2, unit: "piÃ¨ces" }, { name: "Carottes", quantity: 1, unit: "piÃ¨ce" }] },
  { id: 17, name: "Galettes bretonnes", category: "viande", servings: 1, description: "Galettes jambon, Å“ufs, emmental, beurre salÃ©", ingredients: [{ name: "Galettes de blÃ© noir", quantity: 2, unit: "piÃ¨ces" }, { name: "Jambon", quantity: 2, unit: "tranches" }, { name: "Å’ufs", quantity: 2, unit: "piÃ¨ces" }, { name: "Emmental", quantity: 40, unit: "g" }] },
  { id: 18, name: "Wraps poulet", category: "viande", servings: 1, description: "Wraps poulet, tomate, poivron, emmental", ingredients: [{ name: "Tortillas", quantity: 2, unit: "piÃ¨ces" }, { name: "Filet de poulet", quantity: 100, unit: "g" }, { name: "Tomates", quantity: 1, unit: "piÃ¨ce" }, { name: "Emmental", quantity: 30, unit: "g" }] },
  { id: 19, name: "Raclette", category: "viande", servings: 1, description: "Raclette : patates, fromage, charcuterie", ingredients: [{ name: "Pommes de terre", quantity: 200, unit: "g" }, { name: "Fromage Ã  raclette", quantity: 100, unit: "g" }, { name: "Charcuterie", quantity: 80, unit: "g" }] },
  { id: 20, name: "Quiche lorraine", category: "viande", servings: 2, description: "Mode Bake 180Â°/20min", ingredients: [{ name: "PÃ¢te brisÃ©e", quantity: 1, unit: "piÃ¨ce" }, { name: "Lardons", quantity: 100, unit: "g" }, { name: "Å’ufs", quantity: 2, unit: "piÃ¨ces" }, { name: "CrÃ¨me fraÃ®che", quantity: 10, unit: "cl" }, { name: "Emmental", quantity: 50, unit: "g" }] },
  { id: 21, name: "Cassoulet", category: "viande", servings: 2, description: "Cassoulet traditionnel", ingredients: [{ name: "Cassoulet en boÃ®te", quantity: 1, unit: "boÃ®te" }] },
  { id: 22, name: "Aubergines gratinÃ©es steak", category: "viande", servings: 2, description: "Aubergines gratinÃ©es avec steak hachÃ©", ingredients: [{ name: "Aubergines", quantity: 1, unit: "piÃ¨ce" }, { name: "Steak hachÃ©", quantity: 1, unit: "piÃ¨ce" }, { name: "Sauce tomate", quantity: 10, unit: "cl" }, { name: "GruyÃ¨re", quantity: 40, unit: "g" }] },
  { id: 23, name: "Tortilla espagnole", category: "viande", servings: 2, description: "Omelette patates, lardons, Å“ufs, oignons", ingredients: [{ name: "Pommes de terre", quantity: 200, unit: "g" }, { name: "Lardons", quantity: 50, unit: "g" }, { name: "Å’ufs", quantity: 3, unit: "piÃ¨ces" }, { name: "Oignons", quantity: 0.5, unit: "piÃ¨ce" }] },
  { id: 24, name: "Escalope parmesane", category: "viande", servings: 1, description: "Escalope panÃ©e Å“uf, parmesan", ingredients: [{ name: "Escalope de poulet", quantity: 1, unit: "piÃ¨ce" }, { name: "Å’ufs", quantity: 1, unit: "piÃ¨ce" }, { name: "Parmesan", quantity: 30, unit: "g" }] },
  { id: 25, name: "Croque Monsieur", category: "viande", servings: 1, description: "Croque jambon fromage", ingredients: [{ name: "Pain de mie", quantity: 2, unit: "tranches" }, { name: "Jambon", quantity: 2, unit: "tranches" }, { name: "Emmental", quantity: 40, unit: "g" }] },
  { id: 26, name: "Croque Madame", category: "viande", servings: 1, description: "Croque avec Å“uf au plat", ingredients: [{ name: "Pain de mie", quantity: 2, unit: "tranches" }, { name: "Jambon", quantity: 2, unit: "tranches" }, { name: "Emmental", quantity: 40, unit: "g" }, { name: "Å’ufs", quantity: 1, unit: "piÃ¨ce" }] },
  { id: 27, name: "Andouillette", category: "viande", servings: 1, description: "Andouillette grillÃ©e", ingredients: [{ name: "Andouillette", quantity: 1, unit: "piÃ¨ce" }, { name: "Frites", quantity: 150, unit: "g" }] },
  { id: 28, name: "Nouilles chinoises poulet", category: "viande", servings: 1, description: "Nouilles aux lÃ©gumes et poulet", ingredients: [{ name: "Nouilles chinoises", quantity: 100, unit: "g" }, { name: "Filet de poulet", quantity: 100, unit: "g" }, { name: "LÃ©gumes", quantity: 100, unit: "g" }, { name: "Sauce soja", quantity: 2, unit: "c. Ã  soupe" }] },
  { id: 29, name: "Samosas au bÅ“uf", category: "viande", servings: 1, description: "Samosas bÅ“uf Ã©picÃ©s", ingredients: [{ name: "Samosas", quantity: 4, unit: "piÃ¨ces" }, { name: "Salade", quantity: 50, unit: "g" }] },
  { id: 30, name: "Salade gÃ©siers", category: "viande", servings: 1, description: "Salade gÃ©siers/foies de volaille", ingredients: [{ name: "GÃ©siers confits", quantity: 100, unit: "g" }, { name: "Salade", quantity: 80, unit: "g" }, { name: "Tomates cerises", quantity: 50, unit: "g" }] },
  { id: 31, name: "Courgettes farcies lardons", category: "viande", servings: 2, description: "Courgettes farcies aux lardons", ingredients: [{ name: "Courgettes", quantity: 2, unit: "piÃ¨ces" }, { name: "Lardons", quantity: 80, unit: "g" }, { name: "Riz", quantity: 50, unit: "g" }, { name: "GruyÃ¨re", quantity: 30, unit: "g" }] },
  { id: 32, name: "Gratin courgettes lardons", category: "viande", servings: 2, description: "Gratin de courgettes aux lardons", ingredients: [{ name: "Courgettes", quantity: 2, unit: "piÃ¨ces" }, { name: "Lardons", quantity: 80, unit: "g" }, { name: "CrÃ¨me fraÃ®che", quantity: 10, unit: "cl" }, { name: "GruyÃ¨re", quantity: 50, unit: "g" }] },
  { id: 33, name: "Nouilles sautÃ©es poulet", category: "viande", servings: 1, description: "Nouilles sautÃ©es au poulet", ingredients: [{ name: "Nouilles", quantity: 100, unit: "g" }, { name: "Filet de poulet", quantity: 100, unit: "g" }, { name: "Sauce soja", quantity: 2, unit: "c. Ã  soupe" }] },
  { id: 34, name: "Omelette au bacon", category: "viande", servings: 1, description: "Omelette garnie au bacon", ingredients: [{ name: "Å’ufs", quantity: 3, unit: "piÃ¨ces" }, { name: "Bacon", quantity: 3, unit: "tranches" }] },
  { id: 35, name: "PÃ¢tes avocat poulet", category: "viande", servings: 1, description: "PÃ¢tes Ã  l'avocat et poulet", ingredients: [{ name: "PÃ¢tes", quantity: 100, unit: "g" }, { name: "Filet de poulet", quantity: 100, unit: "g" }, { name: "Avocat", quantity: 0.5, unit: "piÃ¨ce" }] },
  { id: 36, name: "PÃ¢tes poulet fromage frais", category: "viande", servings: 2, description: "PÃ¢tes au poulet et fromage frais", ingredients: [{ name: "PÃ¢tes", quantity: 100, unit: "g" }, { name: "Filet de poulet", quantity: 100, unit: "g" }, { name: "Fromage frais", quantity: 50, unit: "g" }] },
  { id: 37, name: "PÃ¢tes crÃ©meuses poulet Ã©pinards", category: "viande", servings: 2, description: "PÃ¢tes crÃ©meuses au poulet et Ã©pinards", ingredients: [{ name: "PÃ¢tes", quantity: 100, unit: "g" }, { name: "Filet de poulet", quantity: 100, unit: "g" }, { name: "Ã‰pinards", quantity: 80, unit: "g" }, { name: "CrÃ¨me fraÃ®che", quantity: 5, unit: "cl" }] },
  { id: 38, name: "PavÃ© de bÅ“uf sauce roquefort", category: "viande", servings: 1, description: "PavÃ© de bÅ“uf sauce roquefort et patates", ingredients: [{ name: "PavÃ© de bÅ“uf", quantity: 150, unit: "g" }, { name: "Roquefort", quantity: 30, unit: "g" }, { name: "Pommes de terre", quantity: 150, unit: "g" }, { name: "CrÃ¨me fraÃ®che", quantity: 3, unit: "cl" }] },
  { id: 39, name: "PoÃªlÃ©e patates poulet champignons", category: "viande", servings: 2, description: "PoÃªlÃ©e patates, poulet, sauce champignons", ingredients: [{ name: "Pommes de terre", quantity: 200, unit: "g" }, { name: "Filet de poulet", quantity: 100, unit: "g" }, { name: "Champignons", quantity: 100, unit: "g" }, { name: "CrÃ¨me fraÃ®che", quantity: 5, unit: "cl" }] },
  { id: 40, name: "Poulet tapenade haricots verts", category: "viande", servings: 2, description: "Poulet Ã  la tapenade et haricots verts", ingredients: [{ name: "Filet de poulet", quantity: 120, unit: "g" }, { name: "Tapenade", quantity: 2, unit: "c. Ã  soupe" }, { name: "Haricots verts", quantity: 150, unit: "g" }] },
  { id: 41, name: "Poulet riz avocat tomate", category: "viande", servings: 1, description: "Poulet au riz, avocat et tomate", ingredients: [{ name: "Filet de poulet", quantity: 100, unit: "g" }, { name: "Riz", quantity: 80, unit: "g" }, { name: "Avocat", quantity: 0.5, unit: "piÃ¨ce" }, { name: "Tomates", quantity: 1, unit: "piÃ¨ce" }] },
  { id: 42, name: "Poulet lÃ©gumes chimichurri", category: "viande", servings: 1, description: "Poulet aux lÃ©gumes sauce chimichurri", ingredients: [{ name: "Filet de poulet", quantity: 120, unit: "g" }, { name: "LÃ©gumes", quantity: 150, unit: "g" }, { name: "Sauce chimichurri", quantity: 2, unit: "c. Ã  soupe" }] },
  { id: 43, name: "Poulet frites", category: "viande", servings: 1, description: "Poulet grillÃ© et frites", ingredients: [{ name: "Filet de poulet", quantity: 120, unit: "g" }, { name: "Frites", quantity: 150, unit: "g" }] },
  { id: 44, name: "Steak frites", category: "viande", servings: 1, description: "Steak hachÃ© et frites", ingredients: [{ name: "Steak hachÃ©", quantity: 1, unit: "piÃ¨ce" }, { name: "Frites", quantity: 150, unit: "g" }] },
  { id: 45, name: "Poulet purÃ©e brocolis", category: "viande", servings: 2, description: "Poulet et purÃ©e de brocolis", ingredients: [{ name: "Filet de poulet", quantity: 120, unit: "g" }, { name: "Brocolis", quantity: 200, unit: "g" }, { name: "CrÃ¨me fraÃ®che", quantity: 3, unit: "cl" }] },
  { id: 46, name: "Poulet ratatouille", category: "viande", servings: 2, description: "Poulet grillÃ© avec ratatouille", ingredients: [{ name: "Filet de poulet", quantity: 120, unit: "g" }, { name: "Ratatouille", quantity: 200, unit: "g" }] },
  { id: 47, name: "Quiche poulet champignons", category: "viande", servings: 2, description: "Quiche sans pÃ¢te poulet champignons, salade", ingredients: [{ name: "Filet de poulet", quantity: 100, unit: "g" }, { name: "Champignons", quantity: 100, unit: "g" }, { name: "Å’ufs", quantity: 2, unit: "piÃ¨ces" }, { name: "CrÃ¨me fraÃ®che", quantity: 5, unit: "cl" }, { name: "Salade", quantity: 50, unit: "g" }] },
  { id: 48, name: "Ratatouille boulettes pÃ¢tes", category: "viande", servings: 2, description: "Ratatouille aux boulettes de viande et pÃ¢tes", ingredients: [{ name: "Boulettes de viande", quantity: 4, unit: "piÃ¨ces" }, { name: "PÃ¢tes", quantity: 100, unit: "g" }, { name: "Ratatouille", quantity: 150, unit: "g" }] },
  { id: 49, name: "Salade pÃ¢tes poulet chÃ¨vre", category: "viande", servings: 1, description: "Salade de pÃ¢tes au poulet et chÃ¨vre", ingredients: [{ name: "PÃ¢tes", quantity: 80, unit: "g" }, { name: "Filet de poulet", quantity: 80, unit: "g" }, { name: "Fromage de chÃ¨vre", quantity: 40, unit: "g" }, { name: "Salade", quantity: 50, unit: "g" }] },
  { id: 50, name: "Sandwich steak fromage", category: "viande", servings: 1, description: "Sandwich au steak hachÃ© et fromage", ingredients: [{ name: "Pain", quantity: 1, unit: "piÃ¨ce" }, { name: "Steak hachÃ©", quantity: 1, unit: "piÃ¨ce" }, { name: "Fromage", quantity: 30, unit: "g" }] },
  { id: 51, name: "Sandwich jambon fromage Å“uf", category: "viande", servings: 1, description: "Sandwich jambon fromage et Å“uf", ingredients: [{ name: "Pain", quantity: 1, unit: "piÃ¨ce" }, { name: "Jambon", quantity: 2, unit: "tranches" }, { name: "Fromage", quantity: 30, unit: "g" }, { name: "Å’ufs", quantity: 1, unit: "piÃ¨ce" }] },
  { id: 52, name: "Steak hachÃ© carottes vichy", category: "viande", servings: 2, description: "Steak hachÃ© et carottes vichy", ingredients: [{ name: "Steak hachÃ©", quantity: 1, unit: "piÃ¨ce" }, { name: "Carottes", quantity: 3, unit: "piÃ¨ces" }, { name: "Beurre", quantity: 15, unit: "g" }] },
  { id: 53, name: "Wrap omelette", category: "viande", servings: 1, description: "Wrap Ã  l'omelette", ingredients: [{ name: "Tortilla", quantity: 1, unit: "piÃ¨ce" }, { name: "Å’ufs", quantity: 2, unit: "piÃ¨ces" }, { name: "Fromage", quantity: 20, unit: "g" }] },
  { id: 54, name: "Wrap jambon mayonnaise", category: "viande", servings: 1, description: "Wrap de jambon mayonnaise", ingredients: [{ name: "Tortilla", quantity: 1, unit: "piÃ¨ce" }, { name: "Jambon", quantity: 2, unit: "tranches" }, { name: "Mayonnaise", quantity: 1, unit: "c. Ã  soupe" }] },
  { id: 55, name: "Wrap kefta", category: "viande", servings: 1, description: "Wrap de kefta", ingredients: [{ name: "Tortilla", quantity: 1, unit: "piÃ¨ce" }, { name: "Kefta", quantity: 80, unit: "g" }, { name: "Tomates", quantity: 0.5, unit: "piÃ¨ce" }] },
  { id: 56, name: "Wrap poulet avocat", category: "viande", servings: 1, description: "Wrap de poulet et avocat", ingredients: [{ name: "Tortilla", quantity: 1, unit: "piÃ¨ce" }, { name: "Filet de poulet", quantity: 80, unit: "g" }, { name: "Avocat", quantity: 0.5, unit: "piÃ¨ce" }] },
  { id: 57, name: "Poulet rÃ´ti riz brocolis", category: "viande", servings: 2, description: "Poulet rÃ´ti + riz basmati + brocolis vapeur", ingredients: [{ name: "Cuisse de poulet", quantity: 1, unit: "piÃ¨ce" }, { name: "Riz basmati", quantity: 80, unit: "g" }, { name: "Brocolis", quantity: 150, unit: "g" }] },
  { id: 58, name: "BÅ“uf hachÃ© patates haricots", category: "viande", servings: 2, description: "BÅ“uf hachÃ© + patates + haricots verts", ingredients: [{ name: "Viande hachÃ©e", quantity: 100, unit: "g" }, { name: "Pommes de terre", quantity: 150, unit: "g" }, { name: "Haricots verts", quantity: 100, unit: "g" }] },
  { id: 59, name: "Omelette patates poivrons", category: "viande", servings: 2, description: "Omelette + patates rissolÃ©es + poivrons", ingredients: [{ name: "Å’ufs", quantity: 3, unit: "piÃ¨ces" }, { name: "Pommes de terre", quantity: 150, unit: "g" }, { name: "Poivrons", quantity: 0.5, unit: "piÃ¨ce" }] },
  { id: 60, name: "Tortilla dinde salade maÃ¯s", category: "viande", servings: 1, description: "Tortilla blÃ© + dinde effilochÃ©e + salade + maÃ¯s", ingredients: [{ name: "Tortilla", quantity: 1, unit: "piÃ¨ce" }, { name: "Dinde", quantity: 80, unit: "g" }, { name: "Salade", quantity: 40, unit: "g" }, { name: "MaÃ¯s", quantity: 30, unit: "g" }] },
  { id: 61, name: "Dinde purÃ©e brocolis", category: "viande", servings: 2, description: "Dinde + purÃ©e de pommes de terre + brocolis", ingredients: [{ name: "Escalope de dinde", quantity: 1, unit: "piÃ¨ce" }, { name: "Pommes de terre", quantity: 150, unit: "g" }, { name: "Brocolis", quantity: 100, unit: "g" }] },
  { id: 62, name: "Boulettes bÅ“uf riz poivrons", category: "viande", servings: 2, description: "Boulettes de bÅ“uf + riz + poivrons", ingredients: [{ name: "Boulettes de bÅ“uf", quantity: 4, unit: "piÃ¨ces" }, { name: "Riz", quantity: 80, unit: "g" }, { name: "Poivrons", quantity: 1, unit: "piÃ¨ce" }] },
  { id: 63, name: "Poulet pois cassÃ©s carottes", category: "viande", servings: 2, description: "Poulet + pois cassÃ©s + carottes vapeur", ingredients: [{ name: "Filet de poulet", quantity: 120, unit: "g" }, { name: "Pois cassÃ©s", quantity: 80, unit: "g" }, { name: "Carottes", quantity: 2, unit: "piÃ¨ces" }] },
  { id: 64, name: "Lapin rÃ´ti patates courgettes", category: "viande", servings: 2, description: "Lapin rÃ´ti + patates + courgettes", ingredients: [{ name: "Lapin", quantity: 150, unit: "g" }, { name: "Pommes de terre", quantity: 150, unit: "g" }, { name: "Courgettes", quantity: 1, unit: "piÃ¨ce" }] },
  { id: 65, name: "Cake jambon courgette chÃ¨vre", category: "viande", servings: 2, description: "Cake jambon, courgette, poivrons, chÃ¨vre", ingredients: [{ name: "Farine", quantity: 80, unit: "g" }, { name: "Jambon", quantity: 50, unit: "g" }, { name: "Courgettes", quantity: 0.5, unit: "piÃ¨ce" }, { name: "Fromage de chÃ¨vre", quantity: 50, unit: "g" }, { name: "Å’ufs", quantity: 2, unit: "piÃ¨ces" }] },
  { id: 66, name: "Salade melon mozzarella jambon", category: "viande", servings: 1, description: "Salade melon, mozzarella et jambon cru", ingredients: [{ name: "Melon", quantity: 0.5, unit: "piÃ¨ce" }, { name: "Mozzarella", quantity: 60, unit: "g" }, { name: "Jambon cru", quantity: 2, unit: "tranches" }] },

  // === POISSONS ===
  { id: 100, name: "Poulpe", category: "poisson", servings: 1, description: "Poulpe grillÃ© ou en salade", ingredients: [{ name: "Poulpe", quantity: 150, unit: "g" }, { name: "Huile d'olive", quantity: 2, unit: "c. Ã  soupe" }, { name: "Citron", quantity: 0.5, unit: "piÃ¨ce" }] },
  { id: 101, name: "PÃ¢tes champignons thon", category: "poisson", servings: 2, description: "PÃ¢tes aux champignons et thon", ingredients: [{ name: "PÃ¢tes", quantity: 100, unit: "g" }, { name: "Thon en conserve", quantity: 80, unit: "g" }, { name: "Champignons", quantity: 80, unit: "g" }, { name: "CrÃ¨me fraÃ®che", quantity: 3, unit: "cl" }] },
  { id: 102, name: "PÃ¢tes champignons sardines", category: "poisson", servings: 2, description: "PÃ¢tes aux champignons et sardines", ingredients: [{ name: "PÃ¢tes", quantity: 100, unit: "g" }, { name: "Sardines", quantity: 1, unit: "boÃ®te" }, { name: "Champignons", quantity: 80, unit: "g" }] },
  { id: 103, name: "PÃ¢tes champignons saumon", category: "poisson", servings: 2, description: "PÃ¢tes aux champignons et saumon", ingredients: [{ name: "PÃ¢tes", quantity: 100, unit: "g" }, { name: "Saumon", quantity: 100, unit: "g" }, { name: "Champignons", quantity: 80, unit: "g" }, { name: "CrÃ¨me fraÃ®che", quantity: 3, unit: "cl" }] },
  { id: 104, name: "PÃ¢tes courgettes saumon", category: "poisson", servings: 2, description: "PÃ¢tes aux courgettes et saumon", ingredients: [{ name: "PÃ¢tes", quantity: 100, unit: "g" }, { name: "Saumon", quantity: 100, unit: "g" }, { name: "Courgettes", quantity: 1, unit: "piÃ¨ce" }] },
  { id: 105, name: "PÃ¢tes saumon fumÃ©", category: "poisson", servings: 1, description: "PÃ¢tes au saumon fumÃ©", ingredients: [{ name: "PÃ¢tes", quantity: 100, unit: "g" }, { name: "Saumon fumÃ©", quantity: 50, unit: "g" }, { name: "CrÃ¨me fraÃ®che", quantity: 5, unit: "cl" }] },
  { id: 106, name: "Linguines crevettes citron", category: "poisson", servings: 1, description: "Linguines crevettes citron (beurre, crÃ¨me, persil, curcuma)", ingredients: [{ name: "Linguines", quantity: 100, unit: "g" }, { name: "Crevettes", quantity: 100, unit: "g" }, { name: "Citron", quantity: 0.5, unit: "piÃ¨ce" }, { name: "Beurre", quantity: 15, unit: "g" }, { name: "CrÃ¨me fraÃ®che", quantity: 3, unit: "cl" }] },
  { id: 107, name: "Tielle salade", category: "poisson", servings: 1, description: "Mode Reheat 180Â°/7min", ingredients: [{ name: "Tielle", quantity: 1, unit: "piÃ¨ce" }, { name: "Salade", quantity: 60, unit: "g" }] },
  { id: 108, name: "Brandade", category: "poisson", servings: 2, description: "Brandade de morue", ingredients: [{ name: "Brandade", quantity: 200, unit: "g" }, { name: "Salade", quantity: 50, unit: "g" }] },
  { id: 109, name: "Seiches", category: "poisson", servings: 1, description: "Seiches Ã  la plancha", ingredients: [{ name: "Seiches", quantity: 150, unit: "g" }, { name: "Ail", quantity: 1, unit: "gousse" }, { name: "Persil", quantity: 1, unit: "c. Ã  soupe" }] },
  { id: 110, name: "Bruschetta tomates mozza sardines", category: "poisson", servings: 1, description: "Bruschetta tomates mozza maquereaux/sardines", ingredients: [{ name: "Pain", quantity: 2, unit: "tranches" }, { name: "Tomates", quantity: 1, unit: "piÃ¨ce" }, { name: "Mozzarella", quantity: 50, unit: "g" }, { name: "Sardines", quantity: 0.5, unit: "boÃ®te" }] },
  { id: 111, name: "Cabillaud sauce moutarde riz", category: "poisson", servings: 2, description: "Cabillaud sauce moutarde, riz, courgette, carotte", ingredients: [{ name: "Cabillaud", quantity: 1, unit: "filet" }, { name: "Riz", quantity: 80, unit: "g" }, { name: "Courgettes", quantity: 0.5, unit: "piÃ¨ce" }, { name: "Carottes", quantity: 1, unit: "piÃ¨ce" }, { name: "Moutarde", quantity: 1, unit: "c. Ã  soupe" }, { name: "CrÃ¨me fraÃ®che", quantity: 3, unit: "cl" }] },
  { id: 112, name: "Cabillaud sauce tomate pÃ¢tes", category: "poisson", servings: 2, description: "Cabillaud Ã  la sauce tomate et pÃ¢tes", ingredients: [{ name: "Cabillaud", quantity: 1, unit: "filet" }, { name: "PÃ¢tes", quantity: 100, unit: "g" }, { name: "Sauce tomate", quantity: 10, unit: "cl" }] },
  { id: 113, name: "Cabillaud papillote riz", category: "poisson", servings: 1, description: "Cabillaud en papillote et riz", ingredients: [{ name: "Cabillaud", quantity: 1, unit: "filet" }, { name: "Riz", quantity: 80, unit: "g" }, { name: "Citron", quantity: 0.25, unit: "piÃ¨ce" }] },
  { id: 114, name: "Cabillaud purÃ©e", category: "poisson", servings: 2, description: "Cabillaud et purÃ©e de pommes de terre", ingredients: [{ name: "Cabillaud", quantity: 1, unit: "filet" }, { name: "Pommes de terre", quantity: 200, unit: "g" }, { name: "Lait", quantity: 5, unit: "cl" }, { name: "Beurre", quantity: 15, unit: "g" }] },
  { id: 115, name: "Crevettes sautÃ©es ail patates", category: "poisson", servings: 1, description: "Crevettes sautÃ©es Ã  l'ail et patates", ingredients: [{ name: "Crevettes", quantity: 120, unit: "g" }, { name: "Pommes de terre", quantity: 150, unit: "g" }, { name: "Ail", quantity: 2, unit: "gousses" }] },
  { id: 116, name: "Å’ufs brouillÃ©s crevettes pÃ¢tes", category: "poisson", servings: 1, description: "Å’ufs brouillÃ©s aux crevettes et pÃ¢tes", ingredients: [{ name: "Å’ufs", quantity: 2, unit: "piÃ¨ces" }, { name: "Crevettes", quantity: 80, unit: "g" }, { name: "PÃ¢tes", quantity: 80, unit: "g" }] },
  { id: 117, name: "PÃ¢tes saumon fromage frais", category: "poisson", servings: 2, description: "PÃ¢tes au saumon et fromage frais", ingredients: [{ name: "PÃ¢tes", quantity: 100, unit: "g" }, { name: "Saumon", quantity: 100, unit: "g" }, { name: "Fromage frais", quantity: 50, unit: "g" }] },
  { id: 118, name: "PÃ¢tes crÃ©meuses saumon fumÃ©", category: "poisson", servings: 1, description: "PÃ¢tes crÃ©meuses au saumon fumÃ©", ingredients: [{ name: "PÃ¢tes", quantity: 100, unit: "g" }, { name: "Saumon fumÃ©", quantity: 50, unit: "g" }, { name: "CrÃ¨me fraÃ®che", quantity: 5, unit: "cl" }] },
  { id: 119, name: "Quiche saumon brocolis", category: "poisson", servings: 2, description: "Quiche sans pÃ¢te au saumon et brocolis", ingredients: [{ name: "Saumon", quantity: 80, unit: "g" }, { name: "Brocolis", quantity: 100, unit: "g" }, { name: "Å’ufs", quantity: 2, unit: "piÃ¨ces" }, { name: "CrÃ¨me fraÃ®che", quantity: 5, unit: "cl" }] },
  { id: 120, name: "Riz crevettes lÃ©gumes", category: "poisson", servings: 2, description: "Riz aux crevettes et petits lÃ©gumes", ingredients: [{ name: "Riz", quantity: 80, unit: "g" }, { name: "Crevettes", quantity: 100, unit: "g" }, { name: "LÃ©gumes", quantity: 100, unit: "g" }] },
  { id: 121, name: "Salade saumon avocat Å“uf", category: "poisson", servings: 1, description: "Salade de saumon, avocat et Å“uf", ingredients: [{ name: "Saumon fumÃ©", quantity: 50, unit: "g" }, { name: "Avocat", quantity: 0.5, unit: "piÃ¨ce" }, { name: "Å’ufs", quantity: 1, unit: "piÃ¨ce" }, { name: "Salade", quantity: 60, unit: "g" }] },
  { id: 122, name: "Sandwich saumon tzatziki", category: "poisson", servings: 1, description: "Sandwich au saumon et tzatziki", ingredients: [{ name: "Pain", quantity: 1, unit: "piÃ¨ce" }, { name: "Saumon fumÃ©", quantity: 50, unit: "g" }, { name: "Tzatziki", quantity: 2, unit: "c. Ã  soupe" }] },
  { id: 123, name: "Saumon purÃ©e courgettes", category: "poisson", servings: 2, description: "Saumon et purÃ©e de courgettes", ingredients: [{ name: "Saumon", quantity: 1, unit: "pavÃ©" }, { name: "Courgettes", quantity: 2, unit: "piÃ¨ces" }, { name: "CrÃ¨me fraÃ®che", quantity: 3, unit: "cl" }] },
  { id: 124, name: "Steak thon purÃ©e carottes", category: "poisson", servings: 1, description: "Steak de thon et purÃ©e de carottes", ingredients: [{ name: "Steak de thon", quantity: 1, unit: "piÃ¨ce" }, { name: "Carottes", quantity: 3, unit: "piÃ¨ces" }, { name: "Beurre", quantity: 15, unit: "g" }] },
  { id: 125, name: "Wrap saumon fromage frais", category: "poisson", servings: 1, description: "Wrap de saumon et fromage frais", ingredients: [{ name: "Tortilla", quantity: 1, unit: "piÃ¨ce" }, { name: "Saumon fumÃ©", quantity: 40, unit: "g" }, { name: "Fromage frais", quantity: 30, unit: "g" }] },
  { id: 126, name: "Steak thon riz courgettes", category: "poisson", servings: 1, description: "Steak de thon + riz + courgettes grillÃ©es", ingredients: [{ name: "Steak de thon", quantity: 1, unit: "piÃ¨ce" }, { name: "Riz", quantity: 80, unit: "g" }, { name: "Courgettes", quantity: 1, unit: "piÃ¨ce" }] },
  { id: 127, name: "Bruschetta saumon", category: "poisson", servings: 1, description: "Bruschetta saumon (pain, saumon fumÃ©, crÃ¨me fraÃ®che, emmental)", ingredients: [{ name: "Pain", quantity: 2, unit: "tranches" }, { name: "Saumon fumÃ©", quantity: 50, unit: "g" }, { name: "CrÃ¨me fraÃ®che", quantity: 2, unit: "c. Ã  soupe" }, { name: "Emmental", quantity: 30, unit: "g" }] },

  // === VÃ‰GÃ‰TARIEN ===
  { id: 200, name: "Camembert rÃ´ti", category: "vÃ©gÃ©tarien", servings: 1, description: "Camembert au four avec salade", ingredients: [{ name: "Camembert", quantity: 1, unit: "piÃ¨ce" }, { name: "Salade", quantity: 60, unit: "g" }, { name: "Noix", quantity: 20, unit: "g" }] },
  { id: 201, name: "Carpaccio", category: "vÃ©gÃ©tarien", servings: 1, description: "Carpaccio de lÃ©gumes ou bÅ“uf", ingredients: [{ name: "Carpaccio", quantity: 100, unit: "g" }, { name: "Parmesan", quantity: 20, unit: "g" }, { name: "Roquette", quantity: 30, unit: "g" }] },
  { id: 202, name: "Pizza", category: "vÃ©gÃ©tarien", servings: 1, description: "Pizza maison ou surgelÃ©e", ingredients: [{ name: "Pizza", quantity: 1, unit: "piÃ¨ce" }] },
  { id: 203, name: "PÃ¢tes pistou Å“ufs", category: "vÃ©gÃ©tarien", servings: 2, description: "PÃ¢tes au pistou avec Å“ufs", ingredients: [{ name: "PÃ¢tes", quantity: 100, unit: "g" }, { name: "Pesto", quantity: 2, unit: "c. Ã  soupe" }, { name: "Å’ufs", quantity: 2, unit: "piÃ¨ces" }] },
  { id: 204, name: "PÃ¢tes fraÃ®ches", category: "vÃ©gÃ©tarien", servings: 1, description: "PÃ¢tes fraÃ®ches Rana ou Lustucru", ingredients: [{ name: "PÃ¢tes fraÃ®ches", quantity: 150, unit: "g" }] },
  { id: 205, name: "PÃ¢tes courgettes omelette", category: "vÃ©gÃ©tarien", servings: 2, description: "PÃ¢tes aux courgettes et omelette", ingredients: [{ name: "PÃ¢tes", quantity: 100, unit: "g" }, { name: "Courgettes", quantity: 1, unit: "piÃ¨ce" }, { name: "Å’ufs", quantity: 2, unit: "piÃ¨ces" }] },
  { id: 206, name: "Patates Ã  la grecque", category: "vÃ©gÃ©tarien", servings: 2, description: "Patates fÃªta, olives, tomate, oignons", ingredients: [{ name: "Pommes de terre", quantity: 200, unit: "g" }, { name: "FÃªta", quantity: 60, unit: "g" }, { name: "Olives", quantity: 30, unit: "g" }, { name: "Tomates", quantity: 1, unit: "piÃ¨ce" }] },
  { id: 207, name: "Soupe", category: "vÃ©gÃ©tarien", servings: 2, description: "Soupe de lÃ©gumes", ingredients: [{ name: "Soupe", quantity: 30, unit: "cl" }, { name: "Pain", quantity: 2, unit: "tranches" }] },
  { id: 208, name: "Omelette", category: "vÃ©gÃ©tarien", servings: 1, description: "Omelette nature ou garnie", ingredients: [{ name: "Å’ufs", quantity: 3, unit: "piÃ¨ces" }, { name: "Beurre", quantity: 10, unit: "g" }] },
  { id: 209, name: "Å’ufs durs", category: "vÃ©gÃ©tarien", servings: 1, description: "Å’ufs durs mayonnaise", ingredients: [{ name: "Å’ufs", quantity: 3, unit: "piÃ¨ces" }, { name: "Mayonnaise", quantity: 1, unit: "c. Ã  soupe" }] },
  { id: 210, name: "Å’ufs Ã  la coque", category: "vÃ©gÃ©tarien", servings: 1, description: "Å’ufs Ã  la coque mouillettes", ingredients: [{ name: "Å’ufs", quantity: 2, unit: "piÃ¨ces" }, { name: "Pain", quantity: 2, unit: "tranches" }, { name: "Beurre", quantity: 10, unit: "g" }] },
  { id: 211, name: "Å’ufs cocotte", category: "vÃ©gÃ©tarien", servings: 1, description: "Å’ufs cocotte Ã  la crÃ¨me", ingredients: [{ name: "Å’ufs", quantity: 2, unit: "piÃ¨ces" }, { name: "CrÃ¨me fraÃ®che", quantity: 3, unit: "cl" }, { name: "Fromage rÃ¢pÃ©", quantity: 20, unit: "g" }] },
  { id: 212, name: "Guacamole", category: "vÃ©gÃ©tarien", servings: 1, description: "Guacamole avec tortillas chips", ingredients: [{ name: "Avocat", quantity: 1, unit: "piÃ¨ce" }, { name: "Citron vert", quantity: 0.5, unit: "piÃ¨ce" }, { name: "Tomates", quantity: 0.5, unit: "piÃ¨ce" }, { name: "Tortillas chips", quantity: 50, unit: "g" }] },
  { id: 213, name: "Aubergines farcies mozzarella", category: "vÃ©gÃ©tarien", servings: 2, description: "Aubergines farcies sauce tomate, mozzarella, basilic, parmesan", ingredients: [{ name: "Aubergines", quantity: 1, unit: "piÃ¨ce" }, { name: "Sauce tomate", quantity: 10, unit: "cl" }, { name: "Mozzarella", quantity: 60, unit: "g" }, { name: "Parmesan", quantity: 20, unit: "g" }] },
  { id: 214, name: "Ravioles", category: "vÃ©gÃ©tarien", servings: 1, description: "Ravioles Ã  la crÃ¨me", ingredients: [{ name: "Ravioles", quantity: 150, unit: "g" }, { name: "CrÃ¨me fraÃ®che", quantity: 5, unit: "cl" }] },
  { id: 215, name: "Frites", category: "vÃ©gÃ©tarien", servings: 1, description: "Frites maison ou surgelÃ©es", ingredients: [{ name: "Frites", quantity: 200, unit: "g" }] },
  { id: 216, name: "Carottes rÃ´ties", category: "vÃ©gÃ©tarien", servings: 2, description: "Carottes rÃ´ties au four", ingredients: [{ name: "Carottes", quantity: 4, unit: "piÃ¨ces" }, { name: "Huile d'olive", quantity: 2, unit: "c. Ã  soupe" }, { name: "Miel", quantity: 1, unit: "c. Ã  soupe" }] },
  { id: 217, name: "Courgettes rÃ´ties", category: "vÃ©gÃ©tarien", servings: 2, description: "Courgettes rÃ´ties au four", ingredients: [{ name: "Courgettes", quantity: 2, unit: "piÃ¨ces" }, { name: "Huile d'olive", quantity: 2, unit: "c. Ã  soupe" }] },
  { id: 218, name: "Salade CÃ©sar", category: "vÃ©gÃ©tarien", servings: 1, description: "Salade CÃ©sar", ingredients: [{ name: "Salade romaine", quantity: 100, unit: "g" }, { name: "Parmesan", quantity: 30, unit: "g" }, { name: "CroÃ»tons", quantity: 30, unit: "g" }, { name: "Sauce CÃ©sar", quantity: 2, unit: "c. Ã  soupe" }] }
];

    const weekSchedule = [
      { day: "Lundi", meals: ["midi", "soir"] },
      { day: "Mardi", meals: ["midi", "soir"] },
      { day: "Mercredi", meals: ["midi", "soir"] },
      { day: "Jeudi", meals: ["midi", "soir"] },
      { day: "Vendredi", meals: ["midi", "soir"] },
      { day: "Samedi", meals: ["midi", "soir"] },
      { day: "Dimanche", meals: ["midi", "soir"] }
    ];

    // MealForm component OUTSIDE MenuPlanner to prevent re-renders and fix input focus issue
    const MealForm = memo(({ form, onUpdate, onSave, isEditing }) => {
      const updateField = (field, value) => onUpdate({ ...form, [field]: value });
      const updateIngredient = (idx, field, value) => {
        const newIngredients = form.ingredients.map((ing, i) => i === idx ? { ...ing, [field]: value } : ing);
        onUpdate({ ...form, ingredients: newIngredients });
      };
      const addIngredient = () => onUpdate({ ...form, ingredients: [...form.ingredients, { name: '', quantity: '', unit: 'g' }] });
      const removeIngredient = (idx) => onUpdate({ ...form, ingredients: form.ingredients.filter((_, i) => i !== idx) });

      return (
        <div className="space-y-3">
          <input type="text" placeholder="Nom du plat" value={form.name} onChange={e => updateField('name', e.target.value)} className="w-full p-3 bg-slate-800 border border-slate-600 rounded-xl text-white" />
          <div className="grid grid-cols-2 gap-2">
            <select value={form.category} onChange={e => updateField('category', e.target.value)} className="p-3 bg-slate-800 border border-slate-600 rounded-xl text-white">
              <option value="viande">ğŸ– Viande</option>
              <option value="poisson">ğŸŸ Poisson</option>
              <option value="vÃ©gÃ©tarien">ğŸ¥— VÃ©gÃ©tarien</option>
            </select>
            <select value={form.servings} onChange={e => updateField('servings', parseInt(e.target.value))} className="p-3 bg-slate-800 border border-slate-600 rounded-xl text-white">
              <option value={1}>1 fois</option>
              <option value={2}>2 fois</option>
            </select>
          </div>
          <textarea placeholder="Instructions..." value={form.description} onChange={e => updateField('description', e.target.value)} className="w-full p-3 bg-slate-800 border border-slate-600 rounded-xl text-white min-h-[60px]" />
          <div className="space-y-2">
            <label className="text-sm text-slate-400">IngrÃ©dients (1 pers.)</label>
            {form.ingredients.map((ing, idx) => (
              <div key={idx} className="flex gap-1">
                <input type="text" placeholder="Nom" value={ing.name} onChange={e => updateIngredient(idx, 'name', e.target.value)} className="flex-1 p-2 bg-slate-800 border border-slate-600 rounded-lg text-white text-sm" />
                <input type="number" placeholder="QtÃ©" value={ing.quantity} onChange={e => updateIngredient(idx, 'quantity', e.target.value)} className="w-14 p-2 bg-slate-800 border border-slate-600 rounded-lg text-white text-sm text-center" />
                <select value={ing.unit} onChange={e => updateIngredient(idx, 'unit', e.target.value)} className="w-16 p-2 bg-slate-800 border border-slate-600 rounded-lg text-white text-sm">
                  <option value="g">g</option><option value="ml">ml</option><option value="cl">cl</option><option value="piÃ¨ce">pce</option><option value="piÃ¨ces">pces</option><option value="c. Ã  soupe">c.s.</option><option value="tranches">tr.</option><option value="boÃ®te">boÃ®te</option><option value="gousse">gousse</option><option value="gousses">gousses</option><option value="filet">filet</option>
                </select>
                {form.ingredients.length > 1 && <button onClick={() => removeIngredient(idx)} className="p-2 text-red-400">âœ•</button>}
              </div>
            ))}
            <button onClick={addIngredient} className="text-teal-400 text-sm">+ IngrÃ©dient</button>
          </div>
          <button onClick={onSave} className="w-full bg-teal-600 text-white font-semibold py-3 rounded-xl">{isEditing ? 'Modifier' : 'Ajouter'}</button>
        </div>
      );
    });

    function MenuPlanner() {
      const [currentView, setCurrentView] = useState('home');
      const [weekMenu, setWeekMenu] = useState(() => {
        const saved = localStorage.getItem('weekMenu');
        return saved ? JSON.parse(saved) : null;
      });
      const [mealsDatabase, setMealsDatabase] = useState(() => {
        const saved = localStorage.getItem('mealsDatabase_v3');
        return saved ? JSON.parse(saved) : defaultMealsDatabase;
      });
      const [draggedItem, setDraggedItem] = useState(null);
      const [expandedMealId, setExpandedMealId] = useState(null);
      const [editingMeal, setEditingMeal] = useState(null);
      const [numberOfPeople, setNumberOfPeople] = useState(() => {
        return parseInt(localStorage.getItem('numberOfPeople')) || 1;
      });
      const [extraItems, setExtraItems] = useState(() => {
        const saved = localStorage.getItem('extraItems');
        return saved ? JSON.parse(saved) : [];
      });
      const [extraItemName, setExtraItemName] = useState('');
      const [extraItemQuantity, setExtraItemQuantity] = useState('');
      const [extraItemUnit, setExtraItemUnit] = useState('piÃ¨ce');
      const [mealSelectorOpen, setMealSelectorOpen] = useState(null);
      const [showAddForm, setShowAddForm] = useState(false);
      const [checkedShoppingItems, setCheckedShoppingItems] = useState(() => {
        const saved = localStorage.getItem('checkedShoppingItems');
        return saved ? new Set(JSON.parse(saved)) : new Set();
      });
      const [newMealForm, setNewMealForm] = useState({ name: '', category: 'viande', servings: 2, description: '', ingredients: [{ name: '', quantity: '', unit: 'g' }] });

      // Save to localStorage
      React.useEffect(() => { localStorage.setItem('mealsDatabase_v3', JSON.stringify(mealsDatabase)); }, [mealsDatabase]);
      React.useEffect(() => { localStorage.setItem('numberOfPeople', numberOfPeople); }, [numberOfPeople]);
      React.useEffect(() => { localStorage.setItem('extraItems', JSON.stringify(extraItems)); }, [extraItems]);
      React.useEffect(() => { if (weekMenu) localStorage.setItem('weekMenu', JSON.stringify(weekMenu)); }, [weekMenu]);
      React.useEffect(() => { localStorage.setItem('checkedShoppingItems', JSON.stringify([...checkedShoppingItems])); }, [checkedShoppingItems]);

      const generateWeekMenu = useCallback(() => {
        const availableMeals = [...mealsDatabase];
        const allMealSlots = [];
        let slotsNeeded = 14;

        for (let i = availableMeals.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [availableMeals[i], availableMeals[j]] = [availableMeals[j], availableMeals[i]];
        }

        let mealIndex = 0;
        while (slotsNeeded > 0 && mealIndex < availableMeals.length) {
          const meal = availableMeals[mealIndex];
          const timesToServe = Math.min(meal.servings, slotsNeeded);
          for (let i = 0; i < timesToServe; i++) {
            allMealSlots.push({ ...meal, slotId: `${meal.id}-${i + 1}` });
            slotsNeeded--;
          }
          mealIndex++;
        }

        while (slotsNeeded > 0) {
          const randomMeal = mealsDatabase[Math.floor(Math.random() * mealsDatabase.length)];
          allMealSlots.push({ ...randomMeal, slotId: `${randomMeal.id}-extra-${slotsNeeded}` });
          slotsNeeded--;
        }

        for (let i = allMealSlots.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [allMealSlots[i], allMealSlots[j]] = [allMealSlots[j], allMealSlots[i]];
        }

        const menu = [];
        let slotIndex = 0;
        weekSchedule.forEach(dayInfo => {
          dayInfo.meals.forEach(mealTime => {
            menu.push({ id: `${dayInfo.day}-${mealTime}`, day: dayInfo.day, mealTime, meal: allMealSlots[slotIndex] });
            slotIndex++;
          });
        });

        setWeekMenu(menu);
        setCheckedShoppingItems(new Set());
        setCurrentView('planning');
      }, [mealsDatabase]);

      const replaceMeal = useCallback((slotId) => {
        const slot = weekMenu.find(s => s.id === slotId);
        if (!slot || !slot.meal) return;
        const originalMealId = slot.meal.id;
        const currentMealIds = weekMenu.filter(s => s.meal && s.meal.id !== originalMealId).map(s => s.meal.id);
        const availableMeals = mealsDatabase.filter(m => !currentMealIds.includes(m.id));
        if (availableMeals.length === 0) { alert("Tous les plats sont utilisÃ©s !"); return; }
        const newMeal = availableMeals[Math.floor(Math.random() * availableMeals.length)];
        setWeekMenu(prev => prev.map(menuSlot => {
          if (menuSlot.meal && menuSlot.meal.id === originalMealId) {
            return { ...menuSlot, meal: { ...newMeal, slotId: `${newMeal.id}-replaced-${menuSlot.id}` } };
          }
          return menuSlot;
        }));
      }, [weekMenu, mealsDatabase]);

      const selectMeal = useCallback((slotId, selectedMeal) => {
        const slot = weekMenu.find(s => s.id === slotId);
        const originalMealId = slot?.meal?.id;
        if (originalMealId) {
          setWeekMenu(prev => prev.map(menuSlot => {
            if (menuSlot.meal && menuSlot.meal.id === originalMealId) {
              return { ...menuSlot, meal: { ...selectedMeal, slotId: `${selectedMeal.id}-manual-${menuSlot.id}` } };
            }
            return menuSlot;
          }));
        } else {
          setWeekMenu(prev => prev.map(menuSlot => {
            if (menuSlot.id === slotId) {
              return { ...menuSlot, meal: { ...selectedMeal, slotId: `${selectedMeal.id}-manual-${slotId}` } };
            }
            return menuSlot;
          }));
        }
        setMealSelectorOpen(null);
      }, [weekMenu]);

      const removeMeal = useCallback((slotId) => {
        setWeekMenu(prev => prev.map(menuSlot => menuSlot.id === slotId ? { ...menuSlot, meal: null } : menuSlot));
      }, []);

      const handleDragStart = (slotId) => setDraggedItem(slotId);
      const handleDragOver = (e) => e.preventDefault();
      const handleDrop = (targetSlotId) => {
        if (draggedItem && draggedItem !== targetSlotId) {
          setWeekMenu(prev => {
            const newMenu = [...prev];
            const di = newMenu.findIndex(s => s.id === draggedItem);
            const ti = newMenu.findIndex(s => s.id === targetSlotId);
            const dm = newMenu[di].meal;
            newMenu[di].meal = newMenu[ti].meal;
            newMenu[ti].meal = dm;
            return newMenu;
          });
        }
        setDraggedItem(null);
      };

      const generateShoppingList = useCallback(() => {
        const list = {};
        if (weekMenu) {
          weekMenu.forEach(slot => {
            if (!slot.meal) return;
            slot.meal.ingredients.forEach(ing => {
              const key = `${ing.name}-${ing.unit}`;
              const qty = ing.quantity * numberOfPeople;
              if (list[key]) list[key].quantity += qty;
              else list[key] = { ...ing, quantity: qty, isExtra: false };
            });
          });
        }
        extraItems.forEach(item => { list[`extra-${item.name}`] = { ...item, isExtra: true }; });
        Object.values(list).forEach(item => { if (item.quantity % 1 !== 0) item.quantity = Math.ceil(item.quantity * 10) / 10; });
        
        const cat = { "ğŸ¥© Viandes": [], "ğŸ¥¬ LÃ©gumes": [], "ğŸ§€ Laitiers": [], "ğŸ Ã‰picerie": [], "ğŸ›’ Ajouts": [], "ğŸ“¦ Autres": [] };
        const kw = {
          "ğŸ¥© Viandes": ["poulet", "bÅ“uf", "veau", "porc", "saumon", "cabillaud", "thon", "viande", "lardons", "jambon", "filet", "tofu", "dinde", "lapin", "saucisse", "steak", "escalope", "bacon", "gÃ©siers", "andouillette", "boulettes", "kefta", "crevettes", "poulpe", "seiches"],
          "ğŸ¥¬ LÃ©gumes": ["pomme", "carotte", "oignon", "courgette", "aubergine", "poivron", "tomate", "brocoli", "salade", "champignon", "citron", "haricot", "navet", "Ã©pinard", "avocat", "lÃ©gume", "pois", "maÃ¯s", "melon", "olive", "roquette"],
          "ğŸ§€ Laitiers": ["crÃ¨me", "lait", "beurre", "fromage", "gruyÃ¨re", "parmesan", "mozzarella", "Å“uf", "bÃ©chamel", "fÃªta", "emmental", "chÃ¨vre", "raclette", "camembert", "roquefort"],
          "ğŸ Ã‰picerie": ["pÃ¢te", "riz", "spaghetti", "penne", "tortilla", "semoule", "nouille", "pois chiche", "haricot rouge", "olive", "pesto", "sauce", "huile", "pain", "farine", "gnocchi", "lentille", "pizza", "raviole", "frite", "linguine", "croÃ»ton", "cassoulet", "brandade", "tielle", "samosa"]
        };
        Object.values(list).forEach(item => {
          if (item.isExtra) { cat["ğŸ›’ Ajouts"].push(item); return; }
          let placed = false;
          for (const [c, words] of Object.entries(kw)) {
            if (words.some(w => item.name.toLowerCase().includes(w))) { cat[c].push(item); placed = true; break; }
          }
          if (!placed) cat["ğŸ“¦ Autres"].push(item);
        });
        return cat;
      }, [weekMenu, numberOfPeople, extraItems]);

      const addExtraItem = useCallback(() => {
        if (!extraItemName.trim() || !extraItemQuantity) return;
        setExtraItems(prev => [...prev, { id: Date.now(), name: extraItemName.trim(), quantity: parseFloat(extraItemQuantity), unit: extraItemUnit }]);
        setExtraItemName(''); setExtraItemQuantity(''); setExtraItemUnit('piÃ¨ce');
      }, [extraItemName, extraItemQuantity, extraItemUnit]);

      const removeExtraItem = useCallback((id) => setExtraItems(prev => prev.filter(i => i.id !== id)), []);
      const toggleShoppingItem = useCallback((key) => setCheckedShoppingItems(prev => { const s = new Set(prev); s.has(key) ? s.delete(key) : s.add(key); return s; }), []);

      const saveMeal = useCallback(() => {
        const form = editingMeal || newMealForm;
        if (!form.name.trim()) { alert("Entrez un nom"); return; }
        const validIng = form.ingredients.filter(i => i.name.trim() && i.quantity);
        if (validIng.length === 0) { alert("Ajoutez un ingrÃ©dient"); return; }
        const data = { id: editingMeal ? editingMeal.id : Date.now(), name: form.name.trim(), category: form.category, servings: parseInt(form.servings) || 2, description: form.description.trim(), ingredients: validIng.map(i => ({ name: i.name.trim(), quantity: parseFloat(i.quantity), unit: i.unit })) };
        if (editingMeal) { setMealsDatabase(prev => prev.map(m => m.id === editingMeal.id ? data : m)); setEditingMeal(null); }
        else setMealsDatabase(prev => [...prev, data]);
        setNewMealForm({ name: '', category: 'viande', servings: 2, description: '', ingredients: [{ name: '', quantity: '', unit: 'g' }] });
      }, [editingMeal, newMealForm]);

      const deleteMeal = (id) => { if (confirm("Supprimer ?")) setMealsDatabase(prev => prev.filter(m => m.id !== id)); };
      const startEditing = (meal) => setEditingMeal({ ...meal, ingredients: [...meal.ingredients] });

      // HOME VIEW
      if (currentView === 'home') return (
        <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-4">
          <div className="max-w-md mx-auto pt-6">
            <div className="text-center mb-8">
              <div className="w-20 h-20 rounded-2xl mx-auto mb-4 flex items-center justify-center shadow-xl overflow-hidden">
                <img src="icon-192.png" alt="Menu Planner" className="w-full h-full object-cover" />
              </div>
              <h1 className="text-2xl font-bold text-white">Menu Planner</h1>
            </div>
            <div className="space-y-3">
              <button onClick={generateWeekMenu} className="w-full bg-gradient-to-r from-teal-500 to-cyan-500 text-white font-semibold py-4 rounded-2xl flex items-center justify-center gap-2">
                <Icon d={Icons.shuffle} className="w-5 h-5" /> GÃ©nÃ©rer le menu
              </button>
              {weekMenu && <button onClick={() => setCurrentView('planning')} className="w-full bg-slate-800 text-white py-4 rounded-2xl flex items-center justify-center gap-2 border border-slate-700">
                <Icon d={Icons.calendar} className="w-5 h-5 text-teal-400" /> Voir le menu
              </button>}
              <button onClick={() => setCurrentView('shopping')} className="w-full bg-slate-800 text-white py-4 rounded-2xl flex items-center justify-center gap-2 border border-slate-700">
                <Icon d={Icons.cart} className="w-5 h-5 text-emerald-400" /> Liste de courses {extraItems.length > 0 && <span className="bg-emerald-500 text-xs px-2 rounded-full">+{extraItems.length}</span>}
              </button>
              <button onClick={() => setCurrentView('database')} className="w-full bg-slate-800 text-white py-4 rounded-2xl flex items-center justify-center gap-2 border border-slate-700">
                <Icon d={Icons.edit} className="w-5 h-5 text-amber-400" /> Plats ({mealsDatabase.length})
              </button>
            </div>
            <div className="mt-6 bg-slate-800 rounded-2xl p-4 border border-slate-700">
              <div className="flex items-center justify-between">
                <span className="text-slate-300 flex items-center gap-2"><Icon d={Icons.users} className="w-5 h-5 text-teal-400" /> Personnes</span>
                <div className="flex items-center gap-2">
                  <button onClick={() => setNumberOfPeople(Math.max(1, numberOfPeople - 1))} className="w-8 h-8 rounded-lg bg-slate-700 text-white font-bold">-</button>
                  <span className="w-8 text-center text-lg font-bold text-white">{numberOfPeople}</span>
                  <button onClick={() => setNumberOfPeople(Math.min(10, numberOfPeople + 1))} className="w-8 h-8 rounded-lg bg-teal-600 text-white font-bold">+</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      );

      // PLANNING VIEW
      if (currentView === 'planning') return (
        <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-4 pb-24">
          <div className="max-w-lg mx-auto">
            <div className="flex items-center justify-between mb-4">
              <button onClick={() => setCurrentView('home')} className="p-2"><Icon d={Icons.arrowLeft} className="w-6 h-6 text-slate-400" /></button>
              <h1 className="text-lg font-bold text-white">Menu semaine</h1>
              <button onClick={generateWeekMenu} className="p-2"><Icon d={Icons.refresh} className="w-6 h-6 text-teal-400" /></button>
            </div>
            <div className="space-y-2">
              {weekMenu?.map(slot => {
                const exp = expandedMealId === slot.id;
                const empty = !slot.meal;
                return (
                  <div key={slot.id} draggable={!empty} onDragStart={() => !empty && handleDragStart(slot.id)} onDragOver={handleDragOver} onDrop={() => handleDrop(slot.id)}
                    className={`bg-slate-800/80 rounded-xl border ${draggedItem === slot.id ? 'opacity-50' : ''} ${empty ? 'border-dashed border-slate-600' : 'border-slate-700'}`}>
                    <div className="p-3 flex items-center gap-2">
                      {!empty && <Icon d={Icons.grip} className="w-4 h-4 text-slate-500 cursor-grab" />}
                      <div className="flex-1 min-w-0" onClick={() => !empty && setExpandedMealId(exp ? null : slot.id)}>
                        <div className="flex items-center gap-2 text-xs mb-0.5">
                          <span className="font-semibold text-teal-400">{slot.day}</span>
                          <span className="px-1.5 py-0.5 bg-slate-700 text-slate-300 rounded">{slot.mealTime}</span>
                          {!empty && <span>{slot.meal.category === 'viande' ? 'ğŸ–' : slot.meal.category === 'poisson' ? 'ğŸŸ' : 'ğŸ¥—'}</span>}
                        </div>
                        <p className={`text-sm truncate ${empty ? 'text-slate-500 italic' : 'text-white font-medium'}`}>{empty ? 'Aucun repas' : slot.meal.name}</p>
                      </div>
                      {!empty && <button onClick={() => setExpandedMealId(exp ? null : slot.id)} className="p-1"><Icon d={exp ? Icons.chevronUp : Icons.chevronDown} className="w-4 h-4 text-slate-400" /></button>}
                      <button onClick={() => setMealSelectorOpen(slot.id)} className="p-1 text-slate-400 hover:text-cyan-400"><Icon d={Icons.list} className="w-4 h-4" /></button>
                      {!empty && <>
                        <button onClick={() => replaceMeal(slot.id)} className="p-1 text-slate-400 hover:text-amber-400"><Icon d={Icons.refresh} className="w-4 h-4" /></button>
                        <button onClick={() => removeMeal(slot.id)} className="p-1 text-slate-400 hover:text-red-400"><Icon d={Icons.minus} className="w-4 h-4" /></button>
                      </>}
                    </div>
                    {exp && slot.meal?.description && (
                      <div className="px-3 pb-3"><div className="bg-slate-900/50 rounded-lg p-2 flex items-start gap-2">
                        <Icon d={Icons.clock} className="w-4 h-4 text-teal-400 mt-0.5" /><p className="text-sm text-slate-300">{slot.meal.description}</p>
                      </div></div>
                    )}
                  </div>
                );
              })}
            </div>
            <div className="fixed bottom-4 left-4 right-4 max-w-lg mx-auto">
              <button onClick={() => setCurrentView('shopping')} className="w-full bg-gradient-to-r from-emerald-600 to-teal-600 text-white font-semibold py-4 rounded-2xl flex items-center justify-center gap-2">
                <Icon d={Icons.cart} className="w-5 h-5" /> Liste de courses
              </button>
            </div>
          </div>
          {mealSelectorOpen && (
            <div className="fixed inset-0 bg-black/80 z-50 flex items-end" onClick={() => setMealSelectorOpen(null)}>
              <div className="bg-slate-800 rounded-t-3xl w-full max-w-lg mx-auto border-t border-slate-700" onClick={e => e.stopPropagation()} style={{maxHeight:'70vh',display:'flex',flexDirection:'column'}}>
                <div className="p-4 border-b border-slate-700 flex justify-between items-center">
                  <h3 className="font-semibold text-white">Choisir un plat</h3>
                  <button onClick={() => setMealSelectorOpen(null)} className="p-2"><Icon d={Icons.x} className="w-5 h-5 text-slate-400" /></button>
                </div>
                <div className="flex-1 overflow-y-auto p-2" style={{WebkitOverflowScrolling:'touch'}}>
                  {mealsDatabase.map(meal => (
                    <button key={meal.id} onClick={() => selectMeal(mealSelectorOpen, meal)} className="w-full p-3 text-left hover:bg-slate-700 rounded-xl flex items-center gap-3 mb-1">
                      <span className="text-xl">{meal.category === 'viande' ? 'ğŸ–' : meal.category === 'poisson' ? 'ğŸŸ' : 'ğŸ¥—'}</span>
                      <div><p className="text-white font-medium">{meal.name}</p><p className="text-xs text-slate-400">Ã—{meal.servings}</p></div>
                    </button>
                  ))}
                </div>
              </div>
            </div>
          )}
        </div>
      );

      // SHOPPING VIEW
      if (currentView === 'shopping') {
        const list = generateShoppingList();
        const total = Object.values(list).flat().length;
        const checked = checkedShoppingItems.size;
        return (
          <div className="min-h-screen bg-gradient-to-br from-slate-900 via-emerald-950 to-slate-900 p-4 pb-8">
            <div className="max-w-lg mx-auto">
              <div className="flex items-center justify-between mb-4">
                <button onClick={() => setCurrentView('home')} className="p-2"><Icon d={Icons.arrowLeft} className="w-6 h-6 text-slate-400" /></button>
                <h1 className="text-lg font-bold text-white">Liste de courses</h1>
                <span className="text-sm text-emerald-400">{checked}/{total}</span>
              </div>
              <div className="mb-4 bg-slate-800/50 rounded-full h-1.5"><div className="bg-emerald-500 h-full rounded-full transition-all" style={{width:`${total>0?(checked/total)*100:0}%`}} /></div>
              <div className="flex gap-2 mb-4">
                <div className="flex-1 bg-slate-800/50 rounded-xl p-3 border border-slate-700"><div className="flex justify-between text-sm"><span className="text-slate-400">Personnes</span><span className="text-white font-bold">{numberOfPeople}</span></div></div>
                <button onClick={() => setShowAddForm(!showAddForm)} className={`px-4 rounded-xl flex items-center gap-1 ${showAddForm ? 'bg-emerald-600 text-white' : 'bg-slate-800/50 text-slate-300 border border-slate-700'}`}>
                  <Icon d={Icons.plus} className="w-4 h-4" /> Ajouter
                </button>
              </div>
              {showAddForm && (
                <div className="bg-slate-800/80 rounded-xl p-3 mb-4 border border-slate-700">
                  <div className="flex gap-2">
                    <input type="text" placeholder="Article" value={extraItemName} onChange={e => setExtraItemName(e.target.value)} className="flex-1 p-2 bg-slate-900 border border-slate-600 rounded-lg text-white text-sm" autoFocus />
                    <input type="number" placeholder="QtÃ©" value={extraItemQuantity} onChange={e => setExtraItemQuantity(e.target.value)} className="w-14 p-2 bg-slate-900 border border-slate-600 rounded-lg text-white text-sm text-center" />
                    <select value={extraItemUnit} onChange={e => setExtraItemUnit(e.target.value)} className="w-16 p-2 bg-slate-800 border border-slate-600 rounded-lg text-white text-sm">
                      <option value="piÃ¨ce">pce</option><option value="g">g</option><option value="kg">kg</option><option value="L">L</option>
                    </select>
                    <button onClick={addExtraItem} className="p-2 bg-emerald-600 text-white rounded-lg"><Icon d={Icons.check} className="w-5 h-5" /></button>
                  </div>
                  {extraItems.length > 0 && <div className="mt-2 pt-2 border-t border-slate-700 flex flex-wrap gap-1">
                    {extraItems.map(item => <span key={item.id} className="inline-flex items-center gap-1 px-2 py-1 bg-emerald-500/20 text-emerald-300 rounded text-sm">{item.name}<button onClick={() => removeExtraItem(item.id)} className="hover:text-red-400">âœ•</button></span>)}
                  </div>}
                </div>
              )}
              <div className="space-y-3">
                {Object.entries(list).map(([cat, items]) => items.length > 0 && (
                  <div key={cat} className="bg-slate-800/60 rounded-xl border border-slate-700">
                    <div className="px-3 py-2 bg-slate-700/30 border-b border-slate-700"><h3 className="font-semibold text-white text-sm">{cat}</h3></div>
                    <div className="p-1">
                      {items.map((item, idx) => {
                        const key = `${cat}-${item.name}-${idx}`;
                        const chk = checkedShoppingItems.has(key);
                        return (
                          <div key={key} onClick={() => toggleShoppingItem(key)} className={`flex items-center gap-2 p-2 rounded-lg cursor-pointer ${chk ? 'bg-emerald-500/10' : 'hover:bg-slate-700/50'}`}>
                            <div className={`w-5 h-5 rounded border-2 flex items-center justify-center ${chk ? 'bg-emerald-500 border-emerald-500' : 'border-slate-500'}`}>{chk && <Icon d={Icons.check} className="w-3 h-3 text-white" />}</div>
                            <span className={`flex-1 text-sm ${chk ? 'line-through text-slate-500' : 'text-slate-200'}`}>{item.name}</span>
                            <span className={`text-xs px-2 py-0.5 rounded ${chk ? 'text-slate-500 bg-slate-800' : 'text-emerald-400 bg-emerald-500/20'}`}>{item.quantity} {item.unit}</span>
                            {item.isExtra && <button onClick={e => { e.stopPropagation(); removeExtraItem(item.id); }} className="p-1 text-slate-400 hover:text-red-400"><Icon d={Icons.trash} className="w-3 h-3" /></button>}
                          </div>
                        );
                      })}
                    </div>
                  </div>
                ))}
              </div>
              {!weekMenu && extraItems.length === 0 && <div className="text-center py-12 text-slate-400"><Icon d={Icons.cart} className="w-12 h-12 mx-auto mb-2 text-slate-600" /><p>GÃ©nÃ©rez un menu ou ajoutez des articles</p></div>}
              {checked === total && total > 0 && <div className="mt-6 text-center"><span className="inline-flex items-center gap-2 px-4 py-2 bg-emerald-500/20 text-emerald-400 rounded-full"><Icon d={Icons.check} className="w-5 h-5" /> TerminÃ© !</span></div>}
            </div>
          </div>
        );
      }

      // DATABASE VIEW
      if (currentView === 'database') return (
        <div className="min-h-screen bg-gradient-to-br from-slate-900 via-amber-950/30 to-slate-900 p-4 pb-8">
          <div className="max-w-lg mx-auto">
            <div className="flex items-center justify-between mb-4">
              <button onClick={() => { setCurrentView('home'); setEditingMeal(null); }} className="p-2"><Icon d={Icons.arrowLeft} className="w-6 h-6 text-slate-400" /></button>
              <h1 className="text-lg font-bold text-white">GÃ©rer les plats</h1>
              <div className="w-10" />
            </div>
            <div className="bg-slate-800/60 rounded-2xl p-4 mb-4 border border-slate-700">
              <h3 className="font-semibold text-white mb-3 flex items-center gap-2">{editingMeal ? <><Icon d={Icons.edit} className="w-5 h-5 text-amber-400" /> Modifier</> : <><Icon d={Icons.plus} className="w-5 h-5 text-teal-400" /> Ajouter</>}</h3>
              {editingMeal ? (
                <>
                  <MealForm form={editingMeal} onUpdate={setEditingMeal} onSave={saveMeal} isEditing={true} />
                  <button onClick={() => setEditingMeal(null)} className="w-full mt-2 py-2 text-slate-400">Annuler</button>
                </>
              ) : (
                <MealForm form={newMealForm} onUpdate={setNewMealForm} onSave={saveMeal} isEditing={false} />
              )}
            </div>
            <div className="space-y-2">
              <div className="flex justify-between px-1 text-slate-400 text-sm"><span>Plats existants</span><span>{mealsDatabase.length}</span></div>
              {mealsDatabase.map(meal => (
                <div key={meal.id} className={`bg-slate-800/60 rounded-xl p-3 border ${editingMeal?.id === meal.id ? 'border-amber-500' : 'border-slate-700'}`}>
                  <div className="flex items-start justify-between gap-2">
                    <div className="flex-1 min-w-0">
                      <div className="flex items-center gap-2 mb-1">
                        <h4 className="font-medium text-white text-sm truncate">{meal.name}</h4>
                        <span className="text-xs">{meal.category === 'viande' ? 'ğŸ–' : meal.category === 'poisson' ? 'ğŸŸ' : 'ğŸ¥—'}</span>
                        <span className="text-xs px-1.5 py-0.5 bg-slate-700 text-slate-300 rounded">Ã—{meal.servings}</span>
                      </div>
                      {meal.description && <p className="text-xs text-slate-400 truncate">{meal.description}</p>}
                    </div>
                    <div className="flex gap-1">
                      <button onClick={() => startEditing(meal)} className="p-1.5 text-slate-400 hover:text-amber-400"><Icon d={Icons.edit} className="w-4 h-4" /></button>
                      <button onClick={() => deleteMeal(meal.id)} className="p-1.5 text-slate-400 hover:text-red-400"><Icon d={Icons.trash} className="w-4 h-4" /></button>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      );

      return null;
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<MenuPlanner />);
  </script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js');
    }
  </script>
</body>
</html>
