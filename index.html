<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#14b8a6">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Menu Planner">
  <title>Menu Planner</title>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.svg">
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * { -webkit-tap-highlight-color: transparent; }
    body { 
      margin: 0; 
      overscroll-behavior: none;
      -webkit-font-smoothing: antialiased;
    }
    input, select, textarea { font-size: 16px !important; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useCallback } = React;

    // Icons as simple SVG components
    const Icon = ({ d, className = "w-5 h-5" }) => (
      <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
        <path strokeLinecap="round" strokeLinejoin="round" d={d} />
      </svg>
    );

    const Icons = {
      utensils: "M12 2L12 8M12 8C10.3431 8 9 9.34315 9 11V12H15V11C15 9.34315 13.6569 8 12 8ZM9 12V22M15 12V22M5 2V8C5 9.10457 5.89543 10 7 10H7.5M5 8H7M19 2V8C19 9.10457 18.1046 10 17 10H16.5M19 8H17",
      shuffle: "M16 3h5v5M4 20L21 3M21 16v5h-5M15 15l6 6M4 4l5 5",
      calendar: "M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z",
      cart: "M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z",
      edit: "M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z",
      arrowLeft: "M10 19l-7-7m0 0l7-7m-7 7h18",
      refresh: "M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15",
      plus: "M12 4v16m8-8H4",
      minus: "M20 12H4",
      trash: "M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16",
      check: "M5 13l4 4L19 7",
      x: "M6 18L18 6M6 6l12 12",
      chevronDown: "M19 9l-7 7-7-7",
      chevronUp: "M5 15l7-7 7 7",
      grip: "M8 6h.01M8 12h.01M8 18h.01M16 6h.01M16 12h.01M16 18h.01",
      users: "M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z",
      clock: "M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z",
      list: "M4 6h16M4 12h16M4 18h16",
      save: "M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"
    };

    // Base de donn√©es initiale
    const defaultMealsDatabase = [
      { id: 1, name: "Poulet r√¥ti aux l√©gumes", category: "viande", servings: 2, description: "Four 200¬∞C, 45 min", ingredients: [{ name: "Cuisses de poulet", quantity: 1, unit: "pi√®ce" }, { name: "Pommes de terre", quantity: 150, unit: "g" }, { name: "Carottes", quantity: 1, unit: "pi√®ce" }, { name: "Oignons", quantity: 0.5, unit: "pi√®ce" }] },
      { id: 2, name: "Spaghetti bolognaise", category: "viande", servings: 2, description: "Mijoter 30 min", ingredients: [{ name: "Spaghetti", quantity: 100, unit: "g" }, { name: "Viande hach√©e", quantity: 100, unit: "g" }, { name: "Tomates concass√©es", quantity: 100, unit: "g" }, { name: "Oignons", quantity: 0.5, unit: "pi√®ce" }] },
      { id: 3, name: "Saumon grill√© et riz", category: "poisson", servings: 1, description: "4 min par c√¥t√©", ingredients: [{ name: "Pav√© de saumon", quantity: 1, unit: "pi√®ce" }, { name: "Riz basmati", quantity: 80, unit: "g" }, { name: "Brocoli", quantity: 100, unit: "g" }] },
      { id: 4, name: "Quiche lorraine", category: "viande", servings: 2, description: "Four 180¬∞C, 35-40 min", ingredients: [{ name: "P√¢te bris√©e", quantity: 0.25, unit: "pi√®ce" }, { name: "Lardons", quantity: 50, unit: "g" }, { name: "≈íufs", quantity: 1, unit: "pi√®ce" }, { name: "Cr√®me fra√Æche", quantity: 5, unit: "cl" }] },
      { id: 5, name: "Curry de l√©gumes", category: "v√©g√©tarien", servings: 2, description: "Mijoter 20 min", ingredients: [{ name: "Pois chiches", quantity: 100, unit: "g" }, { name: "Lait de coco", quantity: 100, unit: "ml" }, { name: "Courgettes", quantity: 0.5, unit: "pi√®ce" }, { name: "Riz", quantity: 80, unit: "g" }] },
      { id: 6, name: "Gratin dauphinois", category: "v√©g√©tarien", servings: 2, description: "Four 180¬∞C, 1h", ingredients: [{ name: "Pommes de terre", quantity: 250, unit: "g" }, { name: "Cr√®me fra√Æche", quantity: 8, unit: "cl" }, { name: "Lait", quantity: 5, unit: "cl" }] },
      { id: 7, name: "Tacos au b≈ìuf", category: "viande", servings: 1, description: "Cuisson 10 min", ingredients: [{ name: "Tortillas", quantity: 2, unit: "pi√®ces" }, { name: "Viande hach√©e", quantity: 100, unit: "g" }, { name: "Haricots rouges", quantity: 60, unit: "g" }, { name: "Tomates", quantity: 1, unit: "pi√®ce" }] },
      { id: 8, name: "Risotto champignons", category: "v√©g√©tarien", servings: 1, description: "25 min en remuant", ingredients: [{ name: "Riz arborio", quantity: 90, unit: "g" }, { name: "Champignons", quantity: 80, unit: "g" }, { name: "Parmesan", quantity: 20, unit: "g" }] },
      { id: 9, name: "Blanquette de veau", category: "viande", servings: 2, description: "1h30 √† feu doux", ingredients: [{ name: "Veau", quantity: 150, unit: "g" }, { name: "Carottes", quantity: 1, unit: "pi√®ce" }, { name: "Cr√®me fra√Æche", quantity: 5, unit: "cl" }, { name: "Riz", quantity: 80, unit: "g" }] },
      { id: 10, name: "P√¢tes au pesto", category: "v√©g√©tarien", servings: 2, description: "P√¢tes al dente", ingredients: [{ name: "Pennes", quantity: 100, unit: "g" }, { name: "Pesto", quantity: 40, unit: "g" }, { name: "Tomates cerises", quantity: 60, unit: "g" }, { name: "Mozzarella", quantity: 50, unit: "g" }] },
      { id: 11, name: "Ratatouille et ≈ìufs", category: "v√©g√©tarien", servings: 2, description: "40 min √† couvert", ingredients: [{ name: "Courgettes", quantity: 0.5, unit: "pi√®ce" }, { name: "Aubergines", quantity: 0.5, unit: "pi√®ce" }, { name: "Tomates", quantity: 1, unit: "pi√®ce" }, { name: "≈íufs", quantity: 2, unit: "pi√®ces" }] },
      { id: 12, name: "Filet mignon pruneaux", category: "viande", servings: 2, description: "Four 180¬∞C, 25 min", ingredients: [{ name: "Filet mignon", quantity: 150, unit: "g" }, { name: "Pruneaux", quantity: 40, unit: "g" }, { name: "Cr√®me fra√Æche", quantity: 5, unit: "cl" }, { name: "Pommes de terre", quantity: 150, unit: "g" }] },
      { id: 13, name: "Salade ni√ßoise", category: "poisson", servings: 1, description: "Servir frais", ingredients: [{ name: "Thon", quantity: 80, unit: "g" }, { name: "Haricots verts", quantity: 80, unit: "g" }, { name: "≈íufs", quantity: 1, unit: "pi√®ce" }, { name: "Tomates", quantity: 1, unit: "pi√®ce" }] },
      { id: 14, name: "Lasagnes", category: "viande", servings: 2, description: "Four 180¬∞C, 45 min", ingredients: [{ name: "Feuilles lasagne", quantity: 3, unit: "pi√®ces" }, { name: "Viande hach√©e", quantity: 125, unit: "g" }, { name: "B√©chamel", quantity: 12, unit: "cl" }, { name: "Gruy√®re", quantity: 40, unit: "g" }] },
      { id: 15, name: "Cabillaud papillote", category: "poisson", servings: 1, description: "Four 200¬∞C, 15 min", ingredients: [{ name: "Cabillaud", quantity: 1, unit: "pi√®ce" }, { name: "Courgettes", quantity: 0.5, unit: "pi√®ce" }, { name: "Citron", quantity: 0.25, unit: "pi√®ce" }] },
      { id: 16, name: "Chili con carne", category: "viande", servings: 2, description: "Mijoter 45 min", ingredients: [{ name: "Viande hach√©e", quantity: 125, unit: "g" }, { name: "Haricots rouges", quantity: 100, unit: "g" }, { name: "Tomates", quantity: 100, unit: "g" }, { name: "Riz", quantity: 80, unit: "g" }] },
      { id: 17, name: "Omelette garnie", category: "v√©g√©tarien", servings: 1, description: "3-4 min", ingredients: [{ name: "≈íufs", quantity: 3, unit: "pi√®ces" }, { name: "Jambon", quantity: 40, unit: "g" }, { name: "Fromage", quantity: 25, unit: "g" }, { name: "Champignons", quantity: 50, unit: "g" }] },
      { id: 18, name: "Couscous v√©g√©tarien", category: "v√©g√©tarien", servings: 2, description: "30 min", ingredients: [{ name: "Semoule", quantity: 100, unit: "g" }, { name: "Pois chiches", quantity: 80, unit: "g" }, { name: "Carottes", quantity: 1, unit: "pi√®ce" }, { name: "Courgettes", quantity: 0.5, unit: "pi√®ce" }] },
      { id: 19, name: "Po√™l√©e asiatique tofu", category: "v√©g√©tarien", servings: 1, description: "10 min au wok", ingredients: [{ name: "Tofu", quantity: 100, unit: "g" }, { name: "Nouilles", quantity: 80, unit: "g" }, { name: "Brocoli", quantity: 80, unit: "g" }, { name: "Sauce soja", quantity: 1, unit: "c. √† soupe" }] },
      { id: 20, name: "Hachis parmentier", category: "viande", servings: 2, description: "Gratiner 20 min √† 200¬∞C", ingredients: [{ name: "Viande hach√©e", quantity: 125, unit: "g" }, { name: "Pommes de terre", quantity: 200, unit: "g" }, { name: "Gruy√®re", quantity: 25, unit: "g" }] }
    ];

    const weekSchedule = [
      { day: "Lundi", meals: ["midi", "soir"] },
      { day: "Mardi", meals: ["midi", "soir"] },
      { day: "Mercredi", meals: ["midi", "soir"] },
      { day: "Jeudi", meals: ["midi", "soir"] },
      { day: "Vendredi", meals: ["midi", "soir"] },
      { day: "Samedi", meals: ["midi", "soir"] },
      { day: "Dimanche", meals: ["midi", "soir"] }
    ];

    function MenuPlanner() {
      const [currentView, setCurrentView] = useState('home');
      const [weekMenu, setWeekMenu] = useState(null);
      const [mealsDatabase, setMealsDatabase] = useState(() => {
        const saved = localStorage.getItem('mealsDatabase');
        return saved ? JSON.parse(saved) : defaultMealsDatabase;
      });
      const [draggedItem, setDraggedItem] = useState(null);
      const [expandedMealId, setExpandedMealId] = useState(null);
      const [editingMeal, setEditingMeal] = useState(null);
      const [numberOfPeople, setNumberOfPeople] = useState(() => {
        return parseInt(localStorage.getItem('numberOfPeople')) || 1;
      });
      const [extraItems, setExtraItems] = useState(() => {
        const saved = localStorage.getItem('extraItems');
        return saved ? JSON.parse(saved) : [];
      });
      const [extraItemName, setExtraItemName] = useState('');
      const [extraItemQuantity, setExtraItemQuantity] = useState('');
      const [extraItemUnit, setExtraItemUnit] = useState('pi√®ce');
      const [mealSelectorOpen, setMealSelectorOpen] = useState(null);
      const [showAddForm, setShowAddForm] = useState(false);
      const [checkedShoppingItems, setCheckedShoppingItems] = useState(new Set());
      const [newMealForm, setNewMealForm] = useState({ name: '', category: 'viande', servings: 2, description: '', ingredients: [{ name: '', quantity: '', unit: 'g' }] });

      // Save to localStorage
      React.useEffect(() => {
        localStorage.setItem('mealsDatabase', JSON.stringify(mealsDatabase));
      }, [mealsDatabase]);
      
      React.useEffect(() => {
        localStorage.setItem('numberOfPeople', numberOfPeople);
      }, [numberOfPeople]);
      
      React.useEffect(() => {
        localStorage.setItem('extraItems', JSON.stringify(extraItems));
      }, [extraItems]);

      const generateWeekMenu = useCallback(() => {
        const availableMeals = [...mealsDatabase];
        const allMealSlots = [];
        let slotsNeeded = 14;

        for (let i = availableMeals.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [availableMeals[i], availableMeals[j]] = [availableMeals[j], availableMeals[i]];
        }

        let mealIndex = 0;
        while (slotsNeeded > 0 && mealIndex < availableMeals.length) {
          const meal = availableMeals[mealIndex];
          const timesToServe = Math.min(meal.servings, slotsNeeded);
          for (let i = 0; i < timesToServe; i++) {
            allMealSlots.push({ ...meal, slotId: `${meal.id}-${i + 1}` });
            slotsNeeded--;
          }
          mealIndex++;
        }

        while (slotsNeeded > 0) {
          const randomMeal = mealsDatabase[Math.floor(Math.random() * mealsDatabase.length)];
          allMealSlots.push({ ...randomMeal, slotId: `${randomMeal.id}-extra-${slotsNeeded}` });
          slotsNeeded--;
        }

        for (let i = allMealSlots.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [allMealSlots[i], allMealSlots[j]] = [allMealSlots[j], allMealSlots[i]];
        }

        const menu = [];
        let slotIndex = 0;
        weekSchedule.forEach(dayInfo => {
          dayInfo.meals.forEach(mealTime => {
            menu.push({ id: `${dayInfo.day}-${mealTime}`, day: dayInfo.day, mealTime, meal: allMealSlots[slotIndex] });
            slotIndex++;
          });
        });

        setWeekMenu(menu);
        setCurrentView('planning');
      }, [mealsDatabase]);

      const replaceMeal = useCallback((slotId) => {
        const slot = weekMenu.find(s => s.id === slotId);
        if (!slot || !slot.meal) return;
        const originalMealId = slot.meal.id;
        const currentMealIds = weekMenu.filter(s => s.meal && s.meal.id !== originalMealId).map(s => s.meal.id);
        const availableMeals = mealsDatabase.filter(m => !currentMealIds.includes(m.id));
        if (availableMeals.length === 0) { alert("Tous les plats sont utilis√©s !"); return; }
        const newMeal = availableMeals[Math.floor(Math.random() * availableMeals.length)];
        setWeekMenu(prev => prev.map(menuSlot => {
          if (menuSlot.meal && menuSlot.meal.id === originalMealId) {
            return { ...menuSlot, meal: { ...newMeal, slotId: `${newMeal.id}-replaced-${menuSlot.id}` } };
          }
          return menuSlot;
        }));
      }, [weekMenu, mealsDatabase]);

      const selectMeal = useCallback((slotId, selectedMeal) => {
        const slot = weekMenu.find(s => s.id === slotId);
        const originalMealId = slot?.meal?.id;
        if (originalMealId) {
          setWeekMenu(prev => prev.map(menuSlot => {
            if (menuSlot.meal && menuSlot.meal.id === originalMealId) {
              return { ...menuSlot, meal: { ...selectedMeal, slotId: `${selectedMeal.id}-manual-${menuSlot.id}` } };
            }
            return menuSlot;
          }));
        } else {
          setWeekMenu(prev => prev.map(menuSlot => {
            if (menuSlot.id === slotId) {
              return { ...menuSlot, meal: { ...selectedMeal, slotId: `${selectedMeal.id}-manual-${slotId}` } };
            }
            return menuSlot;
          }));
        }
        setMealSelectorOpen(null);
      }, [weekMenu]);

      const removeMeal = useCallback((slotId) => {
        setWeekMenu(prev => prev.map(menuSlot => menuSlot.id === slotId ? { ...menuSlot, meal: null } : menuSlot));
      }, []);

      const handleDragStart = (slotId) => setDraggedItem(slotId);
      const handleDragOver = (e) => e.preventDefault();
      const handleDrop = (targetSlotId) => {
        if (draggedItem && draggedItem !== targetSlotId) {
          setWeekMenu(prev => {
            const newMenu = [...prev];
            const di = newMenu.findIndex(s => s.id === draggedItem);
            const ti = newMenu.findIndex(s => s.id === targetSlotId);
            const dm = newMenu[di].meal;
            newMenu[di].meal = newMenu[ti].meal;
            newMenu[ti].meal = dm;
            return newMenu;
          });
        }
        setDraggedItem(null);
      };

      const generateShoppingList = useCallback(() => {
        const list = {};
        if (weekMenu) {
          weekMenu.forEach(slot => {
            if (!slot.meal) return;
            slot.meal.ingredients.forEach(ing => {
              const key = `${ing.name}-${ing.unit}`;
              const qty = ing.quantity * numberOfPeople;
              if (list[key]) list[key].quantity += qty;
              else list[key] = { ...ing, quantity: qty, isExtra: false };
            });
          });
        }
        extraItems.forEach(item => { list[`extra-${item.name}`] = { ...item, isExtra: true }; });
        Object.values(list).forEach(item => { if (item.quantity % 1 !== 0) item.quantity = Math.ceil(item.quantity * 10) / 10; });
        
        const cat = { "ü•© Viandes": [], "ü•¨ L√©gumes": [], "üßÄ Laitiers": [], "üçù √âpicerie": [], "üõí Ajouts": [], "üì¶ Autres": [] };
        const kw = {
          "ü•© Viandes": ["poulet", "b≈ìuf", "veau", "porc", "saumon", "cabillaud", "thon", "viande", "lardons", "jambon", "filet", "tofu"],
          "ü•¨ L√©gumes": ["pomme", "carotte", "oignon", "courgette", "aubergine", "poivron", "tomate", "brocoli", "salade", "champignon", "citron", "haricot", "navet"],
          "üßÄ Laitiers": ["cr√®me", "lait", "beurre", "fromage", "gruy√®re", "parmesan", "mozzarella", "≈ìuf", "b√©chamel"],
          "üçù √âpicerie": ["p√¢te", "riz", "spaghetti", "penne", "tortilla", "semoule", "nouille", "pois chiche", "haricot rouge", "ma√Øs", "olive", "pesto", "sauce", "huile"]
        };
        Object.values(list).forEach(item => {
          if (item.isExtra) { cat["üõí Ajouts"].push(item); return; }
          let placed = false;
          for (const [c, words] of Object.entries(kw)) {
            if (words.some(w => item.name.toLowerCase().includes(w))) { cat[c].push(item); placed = true; break; }
          }
          if (!placed) cat["üì¶ Autres"].push(item);
        });
        return cat;
      }, [weekMenu, numberOfPeople, extraItems]);

      const addExtraItem = useCallback(() => {
        if (!extraItemName.trim() || !extraItemQuantity) return;
        setExtraItems(prev => [...prev, { id: Date.now(), name: extraItemName.trim(), quantity: parseFloat(extraItemQuantity), unit: extraItemUnit }]);
        setExtraItemName(''); setExtraItemQuantity(''); setExtraItemUnit('pi√®ce');
      }, [extraItemName, extraItemQuantity, extraItemUnit]);

      const removeExtraItem = useCallback((id) => setExtraItems(prev => prev.filter(i => i.id !== id)), []);
      const toggleShoppingItem = useCallback((key) => setCheckedShoppingItems(prev => { const s = new Set(prev); s.has(key) ? s.delete(key) : s.add(key); return s; }), []);

      const saveMeal = () => {
        const form = editingMeal || newMealForm;
        if (!form.name.trim()) { alert("Entrez un nom"); return; }
        const validIng = form.ingredients.filter(i => i.name.trim() && i.quantity);
        if (validIng.length === 0) { alert("Ajoutez un ingr√©dient"); return; }
        const data = { id: editingMeal ? editingMeal.id : Date.now(), name: form.name.trim(), category: form.category, servings: parseInt(form.servings) || 2, description: form.description.trim(), ingredients: validIng.map(i => ({ name: i.name.trim(), quantity: parseFloat(i.quantity), unit: i.unit })) };
        if (editingMeal) { setMealsDatabase(prev => prev.map(m => m.id === editingMeal.id ? data : m)); setEditingMeal(null); }
        else setMealsDatabase(prev => [...prev, data]);
        setNewMealForm({ name: '', category: 'viande', servings: 2, description: '', ingredients: [{ name: '', quantity: '', unit: 'g' }] });
      };

      const deleteMeal = (id) => { if (confirm("Supprimer ?")) setMealsDatabase(prev => prev.filter(m => m.id !== id)); };
      const addIngredientField = (e) => { const s = e ? setEditingMeal : setNewMealForm; s(p => ({ ...p, ingredients: [...p.ingredients, { name: '', quantity: '', unit: 'g' }] })); };
      const updateIngredient = (idx, f, v, e) => { const s = e ? setEditingMeal : setNewMealForm; s(p => ({ ...p, ingredients: p.ingredients.map((ing, i) => i === idx ? { ...ing, [f]: v } : ing) })); };
      const removeIngredient = (idx, e) => { const s = e ? setEditingMeal : setNewMealForm; s(p => ({ ...p, ingredients: p.ingredients.filter((_, i) => i !== idx) })); };
      const startEditing = (meal) => setEditingMeal({ ...meal, ingredients: [...meal.ingredients] });

      const MealForm = ({ form, setForm, isEditing = false }) => (
        <div className="space-y-3">
          <input type="text" placeholder="Nom du plat" value={form.name} onChange={e => setForm(p => ({ ...p, name: e.target.value }))} className="w-full p-3 bg-slate-800 border border-slate-600 rounded-xl text-white" />
          <div className="grid grid-cols-2 gap-2">
            <select value={form.category} onChange={e => setForm(p => ({ ...p, category: e.target.value }))} className="p-3 bg-slate-800 border border-slate-600 rounded-xl text-white">
              <option value="viande">üçñ Viande</option>
              <option value="poisson">üêü Poisson</option>
              <option value="v√©g√©tarien">ü•ó V√©g√©tarien</option>
            </select>
            <select value={form.servings} onChange={e => setForm(p => ({ ...p, servings: parseInt(e.target.value) }))} className="p-3 bg-slate-800 border border-slate-600 rounded-xl text-white">
              <option value={1}>1 fois</option>
              <option value={2}>2 fois</option>
            </select>
          </div>
          <textarea placeholder="Instructions..." value={form.description} onChange={e => setForm(p => ({ ...p, description: e.target.value }))} className="w-full p-3 bg-slate-800 border border-slate-600 rounded-xl text-white min-h-[60px]" />
          <div className="space-y-2">
            <label className="text-sm text-slate-400">Ingr√©dients (1 pers.)</label>
            {form.ingredients.map((ing, idx) => (
              <div key={idx} className="flex gap-1">
                <input type="text" placeholder="Nom" value={ing.name} onChange={e => updateIngredient(idx, 'name', e.target.value, isEditing)} className="flex-1 p-2 bg-slate-800 border border-slate-600 rounded-lg text-white text-sm" />
                <input type="number" placeholder="Qt√©" value={ing.quantity} onChange={e => updateIngredient(idx, 'quantity', e.target.value, isEditing)} className="w-14 p-2 bg-slate-800 border border-slate-600 rounded-lg text-white text-sm text-center" />
                <select value={ing.unit} onChange={e => updateIngredient(idx, 'unit', e.target.value, isEditing)} className="w-16 p-2 bg-slate-800 border border-slate-600 rounded-lg text-white text-sm">
                  <option value="g">g</option><option value="ml">ml</option><option value="cl">cl</option><option value="pi√®ce">pce</option><option value="c. √† soupe">c.s.</option>
                </select>
                {form.ingredients.length > 1 && <button onClick={() => removeIngredient(idx, isEditing)} className="p-2 text-red-400">‚úï</button>}
              </div>
            ))}
            <button onClick={() => addIngredientField(isEditing)} className="text-teal-400 text-sm">+ Ingr√©dient</button>
          </div>
          <button onClick={saveMeal} className="w-full bg-teal-600 text-white font-semibold py-3 rounded-xl">{isEditing ? 'Modifier' : 'Ajouter'}</button>
        </div>
      );

      // HOME VIEW
      if (currentView === 'home') return (
        <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-4">
          <div className="max-w-md mx-auto pt-6">
            <div className="text-center mb-8">
              <div className="w-20 h-20 bg-gradient-to-br from-teal-400 to-cyan-500 rounded-2xl mx-auto mb-4 flex items-center justify-center shadow-xl">
                <Icon d={Icons.utensils} className="w-10 h-10 text-white" />
              </div>
              <h1 className="text-2xl font-bold text-white">Menu Planner</h1>
            </div>
            <div className="space-y-3">
              <button onClick={generateWeekMenu} className="w-full bg-gradient-to-r from-teal-500 to-cyan-500 text-white font-semibold py-4 rounded-2xl flex items-center justify-center gap-2">
                <Icon d={Icons.shuffle} /> G√©n√©rer le menu
              </button>
              {weekMenu && <button onClick={() => setCurrentView('planning')} className="w-full bg-slate-800 text-white py-4 rounded-2xl flex items-center justify-center gap-2 border border-slate-700">
                <Icon d={Icons.calendar} className="text-teal-400" /> Voir le menu
              </button>}
              <button onClick={() => setCurrentView('shopping')} className="w-full bg-slate-800 text-white py-4 rounded-2xl flex items-center justify-center gap-2 border border-slate-700">
                <Icon d={Icons.cart} className="text-emerald-400" /> Liste de courses {extraItems.length > 0 && <span className="bg-emerald-500 text-xs px-2 rounded-full">+{extraItems.length}</span>}
              </button>
              <button onClick={() => setCurrentView('database')} className="w-full bg-slate-800 text-white py-4 rounded-2xl flex items-center justify-center gap-2 border border-slate-700">
                <Icon d={Icons.edit} className="text-amber-400" /> Plats ({mealsDatabase.length})
              </button>
            </div>
            <div className="mt-6 bg-slate-800 rounded-2xl p-4 border border-slate-700">
              <div className="flex items-center justify-between">
                <span className="text-slate-300 flex items-center gap-2"><Icon d={Icons.users} className="w-5 h-5 text-teal-400" /> Personnes</span>
                <div className="flex items-center gap-2">
                  <button onClick={() => setNumberOfPeople(Math.max(1, numberOfPeople - 1))} className="w-8 h-8 rounded-lg bg-slate-700 text-white font-bold">-</button>
                  <span className="w-8 text-center text-lg font-bold text-white">{numberOfPeople}</span>
                  <button onClick={() => setNumberOfPeople(Math.min(10, numberOfPeople + 1))} className="w-8 h-8 rounded-lg bg-teal-600 text-white font-bold">+</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      );

      // PLANNING VIEW
      if (currentView === 'planning') return (
        <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-4 pb-24">
          <div className="max-w-lg mx-auto">
            <div className="flex items-center justify-between mb-4">
              <button onClick={() => setCurrentView('home')} className="p-2"><Icon d={Icons.arrowLeft} className="w-6 h-6 text-slate-400" /></button>
              <h1 className="text-lg font-bold text-white">Menu semaine</h1>
              <button onClick={generateWeekMenu} className="p-2"><Icon d={Icons.refresh} className="w-6 h-6 text-teal-400" /></button>
            </div>
            <div className="space-y-2">
              {weekMenu?.map(slot => {
                const exp = expandedMealId === slot.id;
                const empty = !slot.meal;
                return (
                  <div key={slot.id} draggable={!empty} onDragStart={() => !empty && handleDragStart(slot.id)} onDragOver={handleDragOver} onDrop={() => handleDrop(slot.id)}
                    className={`bg-slate-800/80 rounded-xl border ${draggedItem === slot.id ? 'opacity-50' : ''} ${empty ? 'border-dashed border-slate-600' : 'border-slate-700'}`}>
                    <div className="p-3 flex items-center gap-2">
                      {!empty && <Icon d={Icons.grip} className="w-4 h-4 text-slate-500 cursor-grab" />}
                      <div className="flex-1 min-w-0" onClick={() => !empty && setExpandedMealId(exp ? null : slot.id)}>
                        <div className="flex items-center gap-2 text-xs mb-0.5">
                          <span className="font-semibold text-teal-400">{slot.day}</span>
                          <span className="px-1.5 py-0.5 bg-slate-700 text-slate-300 rounded">{slot.mealTime}</span>
                          {!empty && <span>{slot.meal.category === 'viande' ? 'üçñ' : slot.meal.category === 'poisson' ? 'üêü' : 'ü•ó'}</span>}
                        </div>
                        <p className={`text-sm truncate ${empty ? 'text-slate-500 italic' : 'text-white font-medium'}`}>{empty ? 'Aucun repas' : slot.meal.name}</p>
                      </div>
                      {!empty && <button onClick={() => setExpandedMealId(exp ? null : slot.id)} className="p-1"><Icon d={exp ? Icons.chevronUp : Icons.chevronDown} className="w-4 h-4 text-slate-400" /></button>}
                      <button onClick={() => setMealSelectorOpen(slot.id)} className="p-1 text-slate-400 hover:text-cyan-400"><Icon d={Icons.list} className="w-4 h-4" /></button>
                      {!empty && <>
                        <button onClick={() => replaceMeal(slot.id)} className="p-1 text-slate-400 hover:text-amber-400"><Icon d={Icons.refresh} className="w-4 h-4" /></button>
                        <button onClick={() => removeMeal(slot.id)} className="p-1 text-slate-400 hover:text-red-400"><Icon d={Icons.minus} className="w-4 h-4" /></button>
                      </>}
                    </div>
                    {exp && slot.meal?.description && (
                      <div className="px-3 pb-3"><div className="bg-slate-900/50 rounded-lg p-2 flex items-start gap-2">
                        <Icon d={Icons.clock} className="w-4 h-4 text-teal-400 mt-0.5" /><p className="text-sm text-slate-300">{slot.meal.description}</p>
                      </div></div>
                    )}
                  </div>
                );
              })}
            </div>
            <div className="fixed bottom-4 left-4 right-4 max-w-lg mx-auto">
              <button onClick={() => setCurrentView('shopping')} className="w-full bg-gradient-to-r from-emerald-600 to-teal-600 text-white font-semibold py-4 rounded-2xl flex items-center justify-center gap-2">
                <Icon d={Icons.cart} /> Liste de courses
              </button>
            </div>
          </div>
          {mealSelectorOpen && (
            <div className="fixed inset-0 bg-black/80 z-50 flex items-end" onClick={() => setMealSelectorOpen(null)}>
              <div className="bg-slate-800 rounded-t-3xl w-full max-w-lg mx-auto border-t border-slate-700" onClick={e => e.stopPropagation()} style={{maxHeight:'70vh',display:'flex',flexDirection:'column'}}>
                <div className="p-4 border-b border-slate-700 flex justify-between items-center">
                  <h3 className="font-semibold text-white">Choisir un plat</h3>
                  <button onClick={() => setMealSelectorOpen(null)} className="p-2"><Icon d={Icons.x} className="w-5 h-5 text-slate-400" /></button>
                </div>
                <div className="flex-1 overflow-y-auto p-2" style={{WebkitOverflowScrolling:'touch'}}>
                  {mealsDatabase.map(meal => (
                    <button key={meal.id} onClick={() => selectMeal(mealSelectorOpen, meal)} className="w-full p-3 text-left hover:bg-slate-700 rounded-xl flex items-center gap-3 mb-1">
                      <span className="text-xl">{meal.category === 'viande' ? 'üçñ' : meal.category === 'poisson' ? 'üêü' : 'ü•ó'}</span>
                      <div><p className="text-white font-medium">{meal.name}</p><p className="text-xs text-slate-400">√ó{meal.servings}</p></div>
                    </button>
                  ))}
                </div>
              </div>
            </div>
          )}
        </div>
      );

      // SHOPPING VIEW
      if (currentView === 'shopping') {
        const list = generateShoppingList();
        const total = Object.values(list).flat().length;
        const checked = checkedShoppingItems.size;
        return (
          <div className="min-h-screen bg-gradient-to-br from-slate-900 via-emerald-950 to-slate-900 p-4 pb-8">
            <div className="max-w-lg mx-auto">
              <div className="flex items-center justify-between mb-4">
                <button onClick={() => setCurrentView('home')} className="p-2"><Icon d={Icons.arrowLeft} className="w-6 h-6 text-slate-400" /></button>
                <h1 className="text-lg font-bold text-white">Liste de courses</h1>
                <span className="text-sm text-emerald-400">{checked}/{total}</span>
              </div>
              <div className="mb-4 bg-slate-800/50 rounded-full h-1.5"><div className="bg-emerald-500 h-full rounded-full transition-all" style={{width:`${total>0?(checked/total)*100:0}%`}} /></div>
              <div className="flex gap-2 mb-4">
                <div className="flex-1 bg-slate-800/50 rounded-xl p-3 border border-slate-700"><div className="flex justify-between text-sm"><span className="text-slate-400">Personnes</span><span className="text-white font-bold">{numberOfPeople}</span></div></div>
                <button onClick={() => setShowAddForm(!showAddForm)} className={`px-4 rounded-xl flex items-center gap-1 ${showAddForm ? 'bg-emerald-600 text-white' : 'bg-slate-800/50 text-slate-300 border border-slate-700'}`}>
                  <Icon d={Icons.plus} className="w-4 h-4" /> Ajouter
                </button>
              </div>
              {showAddForm && (
                <div className="bg-slate-800/80 rounded-xl p-3 mb-4 border border-slate-700">
                  <div className="flex gap-2">
                    <input type="text" placeholder="Article" value={extraItemName} onChange={e => setExtraItemName(e.target.value)} className="flex-1 p-2 bg-slate-900 border border-slate-600 rounded-lg text-white text-sm" autoFocus />
                    <input type="number" placeholder="Qt√©" value={extraItemQuantity} onChange={e => setExtraItemQuantity(e.target.value)} className="w-14 p-2 bg-slate-900 border border-slate-600 rounded-lg text-white text-sm text-center" />
                    <select value={extraItemUnit} onChange={e => setExtraItemUnit(e.target.value)} className="w-16 p-2 bg-slate-800 border border-slate-600 rounded-lg text-white text-sm">
                      <option value="pi√®ce">pce</option><option value="g">g</option><option value="kg">kg</option><option value="L">L</option>
                    </select>
                    <button onClick={addExtraItem} className="p-2 bg-emerald-600 text-white rounded-lg"><Icon d={Icons.check} className="w-5 h-5" /></button>
                  </div>
                  {extraItems.length > 0 && <div className="mt-2 pt-2 border-t border-slate-700 flex flex-wrap gap-1">
                    {extraItems.map(item => <span key={item.id} className="inline-flex items-center gap-1 px-2 py-1 bg-emerald-500/20 text-emerald-300 rounded text-sm">{item.name}<button onClick={() => removeExtraItem(item.id)} className="hover:text-red-400">‚úï</button></span>)}
                  </div>}
                </div>
              )}
              <div className="space-y-3">
                {Object.entries(list).map(([cat, items]) => items.length > 0 && (
                  <div key={cat} className="bg-slate-800/60 rounded-xl border border-slate-700">
                    <div className="px-3 py-2 bg-slate-700/30 border-b border-slate-700"><h3 className="font-semibold text-white text-sm">{cat}</h3></div>
                    <div className="p-1">
                      {items.map((item, idx) => {
                        const key = `${cat}-${item.name}-${idx}`;
                        const chk = checkedShoppingItems.has(key);
                        return (
                          <div key={key} onClick={() => toggleShoppingItem(key)} className={`flex items-center gap-2 p-2 rounded-lg cursor-pointer ${chk ? 'bg-emerald-500/10' : 'hover:bg-slate-700/50'}`}>
                            <div className={`w-5 h-5 rounded border-2 flex items-center justify-center ${chk ? 'bg-emerald-500 border-emerald-500' : 'border-slate-500'}`}>{chk && <Icon d={Icons.check} className="w-3 h-3 text-white" />}</div>
                            <span className={`flex-1 text-sm ${chk ? 'line-through text-slate-500' : 'text-slate-200'}`}>{item.name}</span>
                            <span className={`text-xs px-2 py-0.5 rounded ${chk ? 'text-slate-500 bg-slate-800' : 'text-emerald-400 bg-emerald-500/20'}`}>{item.quantity} {item.unit}</span>
                            {item.isExtra && <button onClick={e => { e.stopPropagation(); removeExtraItem(item.id); }} className="p-1 text-slate-400 hover:text-red-400"><Icon d={Icons.trash} className="w-3 h-3" /></button>}
                          </div>
                        );
                      })}
                    </div>
                  </div>
                ))}
              </div>
              {!weekMenu && extraItems.length === 0 && <div className="text-center py-12 text-slate-400"><Icon d={Icons.cart} className="w-12 h-12 mx-auto mb-2 text-slate-600" /><p>G√©n√©rez un menu ou ajoutez des articles</p></div>}
              {checked === total && total > 0 && <div className="mt-6 text-center"><span className="inline-flex items-center gap-2 px-4 py-2 bg-emerald-500/20 text-emerald-400 rounded-full"><Icon d={Icons.check} /> Termin√© !</span></div>}
            </div>
          </div>
        );
      }

      // DATABASE VIEW
      if (currentView === 'database') return (
        <div className="min-h-screen bg-gradient-to-br from-slate-900 via-amber-950/30 to-slate-900 p-4 pb-8">
          <div className="max-w-lg mx-auto">
            <div className="flex items-center justify-between mb-4">
              <button onClick={() => { setCurrentView('home'); setEditingMeal(null); }} className="p-2"><Icon d={Icons.arrowLeft} className="w-6 h-6 text-slate-400" /></button>
              <h1 className="text-lg font-bold text-white">G√©rer les plats</h1>
              <div className="w-10" />
            </div>
            <div className="bg-slate-800/60 rounded-2xl p-4 mb-4 border border-slate-700">
              <h3 className="font-semibold text-white mb-3 flex items-center gap-2">{editingMeal ? <><Icon d={Icons.edit} className="w-5 h-5 text-amber-400" /> Modifier</> : <><Icon d={Icons.plus} className="w-5 h-5 text-teal-400" /> Ajouter</>}</h3>
              {editingMeal ? <><MealForm form={editingMeal} setForm={setEditingMeal} isEditing={true} /><button onClick={() => setEditingMeal(null)} className="w-full mt-2 py-2 text-slate-400">Annuler</button></> : <MealForm form={newMealForm} setForm={setNewMealForm} />}
            </div>
            <div className="space-y-2">
              <div className="flex justify-between px-1 text-slate-400 text-sm"><span>Plats existants</span><span>{mealsDatabase.length}</span></div>
              {mealsDatabase.map(meal => (
                <div key={meal.id} className={`bg-slate-800/60 rounded-xl p-3 border ${editingMeal?.id === meal.id ? 'border-amber-500' : 'border-slate-700'}`}>
                  <div className="flex items-start justify-between gap-2">
                    <div className="flex-1 min-w-0">
                      <div className="flex items-center gap-2 mb-1">
                        <h4 className="font-medium text-white text-sm truncate">{meal.name}</h4>
                        <span className="text-xs">{meal.category === 'viande' ? 'üçñ' : meal.category === 'poisson' ? 'üêü' : 'ü•ó'}</span>
                        <span className="text-xs px-1.5 py-0.5 bg-slate-700 text-slate-300 rounded">√ó{meal.servings}</span>
                      </div>
                      {meal.description && <p className="text-xs text-slate-400 truncate">{meal.description}</p>}
                    </div>
                    <div className="flex gap-1">
                      <button onClick={() => startEditing(meal)} className="p-1.5 text-slate-400 hover:text-amber-400"><Icon d={Icons.edit} className="w-4 h-4" /></button>
                      <button onClick={() => deleteMeal(meal.id)} className="p-1.5 text-slate-400 hover:text-red-400"><Icon d={Icons.trash} className="w-4 h-4" /></button>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      );

      return null;
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<MenuPlanner />);
  </script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js');
    }
  </script>
</body>
</html>
